{"version":3,"file":"site.js","sources":["../../../packages/analytics/src/charts/lineChart.js","../../../packages/analytics/src/charts/breakdownList.js","../../../packages/analytics/src/storylineRenderer.js","../../../packages/analytics/src/insightsConsole.js","../../../packages/core/dist/store/createStore.js","../../../packages/core/dist/http/fetcher.js","../../../packages/core/dist/api/content.js","../../../packages/core/dist/schemas/sidebarSchemas.js","../../../packages/core/dist/schemas/workflowSchemas.js","../../../packages/core/dist/renderer/sectionRenderer.js","../../../packages/core/dist/events/eventBus.js","../../../packages/core/dist/capabilities/capabilities.js","../../../packages/core/dist/metrics/metricRegistry.js","../../../packages/dashboard/src/ui/schemaSidebar.ts","../../../packages/dashboard/src/store/dashboardStore.ts","../../../packages/dashboard/src/ui/timelinePanel.ts","../../../packages/dashboard/src/ui/libraryConsole.ts","../../../packages/dashboard/src/ui/sectionDetails.ts","../../../packages/dashboard/src/ui/publishConsole.ts","../../../packages/dashboard/src/ui/dashboardNotifications.ts","../../../packages/dashboard/src/site.ts"],"sourcesContent":["const SVG_NS = \"http://www.w3.org/2000/svg\";\nconst DATE_FORMAT = new Intl.DateTimeFormat(undefined, { month: \"short\", day: \"numeric\" });\nfunction computeTrend(points, width, height) {\n    const chartPoints = points.length ? points : [{ dayUtc: new Date().toISOString(), changes: 0, uniqueEditors: 0 }];\n    const normalized = chartPoints.map((point) => ({\n        date: new Date(point.dayUtc),\n        value: point.changes\n    }));\n    const maxValue = Math.max(1, ...normalized.map((entry) => entry.value));\n    const actualWidth = Math.max(width, 1);\n    const step = normalized.length > 1 ? actualWidth / (normalized.length - 1) : 0;\n    const computed = normalized.map((entry, index) => ({\n        x: index * step,\n        y: maxValue === 0 ? 0 : 1 - entry.value / maxValue,\n        value: entry.value,\n        label: DATE_FORMAT.format(entry.date)\n    }));\n    return {\n        maxValue,\n        points: computed.map((entry) => ({\n            x: entry.x,\n            y: entry.y,\n            value: entry.value,\n            label: entry.label\n        }))\n    };\n}\nfunction makeSvg(width, height) {\n    const svg = document.createElementNS(SVG_NS, \"svg\");\n    svg.setAttribute(\"viewBox\", `0 0 ${width} ${height}`);\n    svg.setAttribute(\"preserveAspectRatio\", \"xMidYMid meet\");\n    svg.setAttribute(\"role\", \"img\");\n    svg.classList.add(\"insights-analytics__svg\");\n    return svg;\n}\nfunction createPath(d, className) {\n    const path = document.createElementNS(SVG_NS, \"path\");\n    path.setAttribute(\"d\", d);\n    path.setAttribute(\"class\", className);\n    return path;\n}\nfunction createCircle(x, y, value, label) {\n    const circle = document.createElementNS(SVG_NS, \"circle\");\n    circle.setAttribute(\"cx\", x.toFixed(2));\n    circle.setAttribute(\"cy\", y.toFixed(2));\n    circle.setAttribute(\"r\", value > 0 ? \"3.5\" : \"2\");\n    circle.setAttribute(\"data-value\", value.toString(10));\n    circle.setAttribute(\"data-label\", label);\n    circle.classList.add(\"insights-analytics__point\");\n    return circle;\n}\nexport function renderTrendChart(host, trend) {\n    host.innerHTML = \"\";\n    const margin = { top: 16, right: 16, bottom: 32, left: 40 };\n    const width = 640;\n    const height = 240;\n    const chartWidth = width - margin.left - margin.right;\n    const chartHeight = height - margin.top - margin.bottom;\n    const { points, maxValue } = computeTrend(trend, chartWidth, chartHeight);\n    if (!trend.length || maxValue === 0) {\n        const empty = document.createElement(\"p\");\n        empty.className = \"insights-analytics__empty\";\n        empty.textContent = \"No activity matched the current filters.\";\n        host.appendChild(empty);\n        return;\n    }\n    const svg = makeSvg(width, height);\n    const group = document.createElementNS(SVG_NS, \"g\");\n    group.setAttribute(\"transform\", `translate(${margin.left}, ${margin.top})`);\n    svg.appendChild(group);\n    const baseline = chartHeight;\n    const pathPoints = points.map((point) => {\n        const x = point.x;\n        const y = chartHeight * point.y;\n        return { ...point, x, y };\n    });\n    const lineD = pathPoints\n        .map((point, index) => `${index === 0 ? \"M\" : \"L\"}${point.x.toFixed(2)} ${point.y.toFixed(2)}`)\n        .join(\" \");\n    const areaD = [\n        `M${pathPoints[0].x.toFixed(2)} ${baseline.toFixed(2)}`,\n        ...pathPoints.map((point) => `L${point.x.toFixed(2)} ${point.y.toFixed(2)}`),\n        `L${pathPoints[pathPoints.length - 1].x.toFixed(2)} ${baseline.toFixed(2)}`,\n        \"Z\"\n    ].join(\" \");\n    group.appendChild(createPath(areaD, \"insights-analytics__area\"));\n    group.appendChild(createPath(lineD, \"insights-analytics__line\"));\n    pathPoints.forEach((point) => {\n        const circle = createCircle(point.x, point.y, point.value, point.label);\n        group.appendChild(circle);\n    });\n    // Horizontal grid line at half-way point for quick visual reference\n    const midValue = Math.max(1, Math.round(maxValue / 2));\n    const grid = document.createElementNS(SVG_NS, \"line\");\n    grid.setAttribute(\"x1\", \"0\");\n    grid.setAttribute(\"x2\", chartWidth.toFixed(2));\n    grid.setAttribute(\"y1\", (chartHeight - (chartHeight * (midValue / maxValue))).toFixed(2));\n    grid.setAttribute(\"y2\", (chartHeight - (chartHeight * (midValue / maxValue))).toFixed(2));\n    grid.setAttribute(\"class\", \"insights-analytics__grid\");\n    group.appendChild(grid);\n    const axis = document.createElementNS(SVG_NS, \"line\");\n    axis.setAttribute(\"x1\", \"0\");\n    axis.setAttribute(\"x2\", chartWidth.toFixed(2));\n    axis.setAttribute(\"y1\", baseline.toFixed(2));\n    axis.setAttribute(\"y2\", baseline.toFixed(2));\n    axis.setAttribute(\"class\", \"insights-analytics__axis\");\n    group.appendChild(axis);\n    const labels = document.createElementNS(SVG_NS, \"g\");\n    labels.setAttribute(\"class\", \"insights-analytics__labels\");\n    const labelIndices = new Set();\n    labelIndices.add(0);\n    if (pathPoints.length > 2) {\n        labelIndices.add(Math.floor((pathPoints.length - 1) / 2));\n    }\n    labelIndices.add(pathPoints.length - 1);\n    labelIndices.forEach((index) => {\n        const point = pathPoints[index];\n        const text = document.createElementNS(SVG_NS, \"text\");\n        text.textContent = points[index].label;\n        text.setAttribute(\"x\", point.x.toFixed(2));\n        text.setAttribute(\"y\", (baseline + 20).toFixed(2));\n        text.setAttribute(\"text-anchor\", \"middle\");\n        labels.appendChild(text);\n    });\n    group.appendChild(labels);\n    host.appendChild(svg);\n}\n//# sourceMappingURL=lineChart.js.map","export function renderBreakdownList(host, entries, emptyLabel) {\n    host.innerHTML = \"\";\n    if (!entries.length) {\n        const empty = document.createElement(\"p\");\n        empty.className = \"insights-analytics__empty\";\n        empty.textContent = emptyLabel;\n        host.appendChild(empty);\n        return;\n    }\n    const total = entries.reduce((sum, entry) => sum + entry.changes, 0);\n    const list = document.createElement(\"ul\");\n    list.className = \"insights-analytics__list\";\n    entries.forEach((entry) => {\n        const item = document.createElement(\"li\");\n        item.className = \"insights-analytics__list-item\";\n        const label = document.createElement(\"span\");\n        label.className = \"insights-analytics__list-label\";\n        label.textContent = entry.label;\n        const value = document.createElement(\"strong\");\n        value.className = \"insights-analytics__list-value\";\n        value.textContent = entry.changes.toLocaleString();\n        const bar = document.createElement(\"span\");\n        bar.className = \"insights-analytics__list-meter\";\n        const percentage = total > 0 ? Math.round((entry.changes / total) * 100) : 0;\n        bar.style.setProperty(\"--meter\", `${percentage}`);\n        bar.textContent = `${percentage}%`;\n        item.append(label, value, bar);\n        list.appendChild(item);\n    });\n    host.appendChild(list);\n}\n//# sourceMappingURL=breakdownList.js.map","const DATE_TIME_FORMAT = new Intl.DateTimeFormat(undefined, {\n    month: \"short\",\n    day: \"numeric\"\n});\nfunction formatHighlight(value) {\n    const date = new Date(value);\n    if (Number.isNaN(date.getTime())) {\n        return value;\n    }\n    return DATE_TIME_FORMAT.format(date);\n}\nexport function renderStoryline(host, events) {\n    host.innerHTML = \"\";\n    if (!events.length) {\n        const empty = document.createElement(\"p\");\n        empty.className = \"insights-analytics__empty\";\n        empty.textContent = \"No storyline events detected for this range.\";\n        host.appendChild(empty);\n        return;\n    }\n    const list = document.createElement(\"ul\");\n    list.className = \"insights-storyline__list\";\n    events.forEach((event) => {\n        const item = document.createElement(\"li\");\n        item.className = \"insights-storyline__item\";\n        const icon = document.createElement(\"span\");\n        icon.className = `insights-storyline__icon ${event.icon}`;\n        icon.setAttribute(\"aria-hidden\", \"true\");\n        const content = document.createElement(\"div\");\n        content.className = \"insights-storyline__content\";\n        const heading = document.createElement(\"div\");\n        heading.className = \"insights-storyline__heading\";\n        const title = document.createElement(\"strong\");\n        title.textContent = event.title;\n        const timestamp = document.createElement(\"span\");\n        timestamp.className = \"insights-storyline__timestamp\";\n        timestamp.textContent = formatHighlight(event.highlightUtc);\n        heading.append(title, timestamp);\n        const summary = document.createElement(\"p\");\n        summary.textContent = event.summary;\n        content.append(heading);\n        if (event.accent) {\n            const accent = document.createElement(\"span\");\n            accent.className = \"insights-storyline__accent\";\n            accent.textContent = event.accent;\n            content.append(accent);\n        }\n        content.append(summary);\n        if (typeof event.changes === \"number\" && !Number.isNaN(event.changes)) {\n            const badge = document.createElement(\"span\");\n            badge.className = \"insights-storyline__badge\";\n            badge.textContent = `${event.changes.toLocaleString()} change${Math.abs(event.changes) === 1 ? \"\" : \"s\"}`;\n            content.append(badge);\n        }\n        item.append(icon, content);\n        list.appendChild(item);\n    });\n    host.appendChild(list);\n}\n//# sourceMappingURL=storylineRenderer.js.map","import { renderTrendChart } from \"./charts/lineChart\";\nimport { renderBreakdownList } from \"./charts/breakdownList\";\nimport { renderStoryline } from \"./storylineRenderer\";\nconst RANGE_FORMAT = new Intl.DateTimeFormat(undefined, {\n    month: \"short\",\n    day: \"numeric\"\n});\nfunction parsePayload(script) {\n    const raw = script.textContent?.trim();\n    if (!raw) {\n        return null;\n    }\n    try {\n        return JSON.parse(raw);\n    }\n    catch (error) {\n        console.warn(\"[analytics] Failed to parse analytics payload\", error);\n        return null;\n    }\n}\nfunction formatRange(start, end) {\n    const startDate = new Date(start);\n    const endDate = new Date(end);\n    if (Number.isNaN(startDate.getTime()) || Number.isNaN(endDate.getTime())) {\n        return \"\";\n    }\n    return `${RANGE_FORMAT.format(startDate)} – ${RANGE_FORMAT.format(endDate)}`;\n}\nfunction hydrateAnalytics(root, payload) {\n    const trendHost = root.querySelector('[data-analytics-chart=\"trend\"]');\n    if (trendHost) {\n        renderTrendChart(trendHost, payload.trend);\n    }\n    const editorsHost = root.querySelector('[data-analytics-breakdown=\"editors\"]');\n    if (editorsHost) {\n        renderBreakdownList(editorsHost, payload.topEditors, \"No editor activity in range.\");\n    }\n    const fieldsHost = root.querySelector('[data-analytics-breakdown=\"fields\"]');\n    if (fieldsHost) {\n        renderBreakdownList(fieldsHost, payload.topFields, \"No field changes captured.\");\n    }\n    const storylineHost = root.querySelector('[data-analytics-storyline]');\n    if (storylineHost) {\n        renderStoryline(storylineHost, payload.storyline);\n    }\n    const summaryLabel = root.querySelector('[data-analytics-summary]');\n    if (summaryLabel) {\n        const range = formatRange(payload.rangeStartUtc, payload.rangeEndUtc);\n        summaryLabel.textContent = range ? `${payload.totalChanges.toLocaleString()} changes · ${range}` : `${payload.totalChanges.toLocaleString()} changes`;\n    }\n    root.dataset.analyticsReady = \"true\";\n}\nfunction discoverRoots(target) {\n    if (target instanceof HTMLElement) {\n        return [target].filter((element) => element.matches('[data-analytics-root]'));\n    }\n    return Array.from(target.querySelectorAll('[data-analytics-root]'));\n}\nexport function initInsightsAnalytics(target = document) {\n    const roots = discoverRoots(target);\n    if (!roots.length && target instanceof Document) {\n        const fallback = target.querySelector('[data-analytics-root]');\n        if (fallback) {\n            roots.push(fallback);\n        }\n    }\n    roots.forEach((root) => {\n        const script = root.querySelector('[data-analytics-config]');\n        if (!script) {\n            return;\n        }\n        const payload = parsePayload(script);\n        if (!payload) {\n            return;\n        }\n        hydrateAnalytics(root, payload);\n    });\n}\n//# sourceMappingURL=insightsConsole.js.map","export function createStore(initializer) {\n    const listeners = new Set();\n    const getInitialState = typeof initializer === \"function\"\n        ? initializer\n        : () => ({ ...initializer });\n    let state = getInitialState();\n    const getState = () => state;\n    const setState = (action) => {\n        const partial = typeof action === \"function\"\n            ? action(state)\n            : action;\n        if (!partial) {\n            return;\n        }\n        state = Object.freeze({ ...state, ...partial });\n        listeners.forEach((listener) => listener(state));\n    };\n    const subscribe = (listener) => {\n        listeners.add(listener);\n        return () => {\n            listeners.delete(listener);\n        };\n    };\n    const reset = () => {\n        state = Object.freeze({ ...getInitialState() });\n        listeners.forEach((listener) => listener(state));\n    };\n    // Ensure the initial state is immutable copy.\n    state = Object.freeze({ ...state });\n    return {\n        getState,\n        setState,\n        subscribe,\n        reset\n    };\n}\n","const resourceCache = new Map();\nconst DEFAULT_TTL_MS = 15_000;\nexport async function fetchResource(cacheKey, input, options = {}) {\n    const now = Date.now();\n    const ttlMs = options.ttlMs ?? DEFAULT_TTL_MS;\n    const cached = resourceCache.get(cacheKey);\n    if (!options.revalidate && cached && now - cached.timestamp <= ttlMs) {\n        return { data: cached.data, etag: cached.etag, fromCache: true };\n    }\n    const headers = new Headers(options.headers ?? {});\n    if (cached?.etag) {\n        headers.set(\"If-None-Match\", cached.etag);\n    }\n    const response = await fetch(input, {\n        ...options,\n        headers\n    });\n    if (response.status === 304 && cached) {\n        cached.timestamp = now;\n        resourceCache.set(cacheKey, cached);\n        return { data: cached.data, etag: cached.etag, fromCache: true };\n    }\n    if (!response.ok) {\n        throw new Error(await extractErrorMessage(response));\n    }\n    const data = (await response.json());\n    const etag = response.headers.get(\"ETag\");\n    resourceCache.set(cacheKey, {\n        data,\n        etag,\n        timestamp: now\n    });\n    return { data, etag: etag ?? undefined, fromCache: false };\n}\nexport function invalidateResource(cacheKey) {\n    resourceCache.delete(cacheKey);\n}\nexport function getCachedResource(cacheKey) {\n    return resourceCache.get(cacheKey)?.data;\n}\nexport function setCachedResource(cacheKey, data, etag) {\n    resourceCache.set(cacheKey, {\n        data,\n        etag,\n        timestamp: Date.now()\n    });\n}\nasync function extractErrorMessage(response) {\n    try {\n        const payload = await response.clone().json();\n        if (typeof payload?.message === \"string\") {\n            return payload.message;\n        }\n        if (typeof payload?.Message === \"string\") {\n            return payload.Message;\n        }\n    }\n    catch {\n        // ignore json parse failures\n    }\n    const text = await response.text();\n    if (text) {\n        return text;\n    }\n    return `Request failed with status ${response.status}`;\n}\n","import { fetchResource, invalidateResource } from \"../http/fetcher\";\nconst CONTENT_BASE = \"/api/content\";\nexport async function fetchPageCollection(options = {}) {\n    return fetchResource(\"content:pages\", `${CONTENT_BASE}/pages`, options);\n}\nexport async function fetchPageDetail(pageId, options = {}) {\n    return fetchResource(`content:pages:${pageId}`, `${CONTENT_BASE}/pages/${pageId}`, options);\n}\nexport async function fetchSections(pageId, options = {}) {\n    const search = new URLSearchParams({ pageId });\n    return fetchResource(`content:sections:${pageId}`, `${CONTENT_BASE}/sections?${search.toString()}`, options);\n}\nexport async function fetchHistory(params = {}, options = {}) {\n    const search = new URLSearchParams();\n    if (params.pageId) {\n        search.set(\"pageId\", params.pageId);\n    }\n    if (params.take) {\n        search.set(\"take\", params.take.toString());\n    }\n    const key = `content:history:${params.pageId ?? \"all\"}${params.take ? `:${params.take}` : \"\"}`;\n    const url = search.size > 0\n        ? `${CONTENT_BASE}/history?${search.toString()}`\n        : `${CONTENT_BASE}/history`;\n    return fetchResource(key, url, options);\n}\nexport function invalidateContentCache(pageId) {\n    invalidateResource(\"content:pages\");\n    if (pageId) {\n        invalidateResource(`content:pages:${pageId}`);\n        invalidateResource(`content:sections:${pageId}`);\n        invalidateResource(`content:history:${pageId}`);\n    }\n}\n","export const sidebarCards = {\n    publishing_overview: {\n        id: \"publishing_overview\",\n        title: \"Publishing Overview\",\n        description: \"Track last publish and outstanding drafts.\",\n        metrics: [\n            {\n                id: \"draft-count\",\n                label: \"Draft sections\",\n                description: \"Blocks updated since last publish.\",\n                icon: \"fa-solid fa-pen-to-square\",\n                compute: \"dynamic\",\n                valueField: \"draftCount\",\n                formatter: \"number\",\n                emphasis: \"warning\"\n            },\n            {\n                id: \"last-published\",\n                label: \"Last publish\",\n                description: \"Most recent publish timestamp.\",\n                icon: \"fa-solid fa-rocket\",\n                compute: \"dynamic\",\n                valueField: \"lastPublishedAtUtc\",\n                formatter: \"datetime\"\n            }\n        ],\n        actions: [\n            {\n                id: \"open-publish-dialog\",\n                label: \"Publish updates\",\n                icon: \"fa-solid fa-rocket-launch\",\n                intent: \"primary\",\n                target: \"command\",\n                command: \"canvas.publish\"\n            }\n        ],\n        footerHint: \"Publishing requires review of all draft sections.\"\n    },\n    quality_checks: {\n        id: \"quality_checks\",\n        title: \"Quality Checks\",\n        description: \"Automated guardrails before shipping.\",\n        metrics: [\n            {\n                id: \"accessibility-score\",\n                label: \"Accessibility score\",\n                description: \"Automated scan of current page.\",\n                icon: \"fa-solid fa-universal-access\",\n                compute: \"dynamic\",\n                valueField: \"accessibilityScore\",\n                formatter: \"percentage\",\n                emphasis: \"default\"\n            },\n            {\n                id: \"broken-links\",\n                label: \"Broken links\",\n                icon: \"fa-solid fa-link-slash\",\n                compute: \"dynamic\",\n                valueField: \"brokenLinkCount\",\n                formatter: \"number\",\n                emphasis: \"warning\"\n            }\n        ],\n        actions: [\n            {\n                id: \"run-accessibility-scan\",\n                label: \"Run scan\",\n                icon: \"fa-solid fa-magnifying-glass-chart\",\n                target: \"command\",\n                command: \"canvas.scanAccessibility\"\n            }\n        ]\n    },\n    quick_actions: {\n        id: \"quick_actions\",\n        title: \"Quick Actions\",\n        actions: [\n            {\n                id: \"open-history\",\n                label: \"View history\",\n                icon: \"fa-solid fa-wave-square\",\n                target: \"drawer\",\n                command: \"dashboard.openHistory\"\n            },\n            {\n                id: \"schedule-reminder\",\n                label: \"Schedule reminder\",\n                icon: \"fa-solid fa-clock\",\n                target: \"modal\",\n                command: \"dashboard.scheduleReminder\"\n            },\n            {\n                id: \"request-review\",\n                label: \"Request review\",\n                icon: \"fa-solid fa-user-check\",\n                target: \"command\",\n                command: \"canvas.requestReview\"\n            }\n        ],\n        footerHint: \"Customize quick actions via admin settings.\"\n    }\n};\n","export const workflowSchemas = {\n    default_content_flow: {\n        id: \"default_content_flow\",\n        title: \"Content Workflow\",\n        defaultStepId: \"draft\",\n        steps: [\n            {\n                id: \"draft\",\n                label: \"Draft\",\n                description: \"Edit sections and capture notes.\",\n                icon: \"fa-solid fa-pencil\",\n                status: \"draft\",\n                actions: [\n                    {\n                        id: \"submit-for-review\",\n                        label: \"Submit for review\",\n                        icon: \"fa-solid fa-share\",\n                        intent: \"primary\",\n                        target: \"command\",\n                        command: \"workflow.submitReview\"\n                    }\n                ]\n            },\n            {\n                id: \"review\",\n                label: \"Review\",\n                description: \"Verify tone, accessibility, and QA checks.\",\n                icon: \"fa-solid fa-clipboard-check\",\n                status: \"review\",\n                blockers: [\"missingAccessibilityScan\", \"unresolvedComments\"],\n                actions: [\n                    {\n                        id: \"request-changes\",\n                        label: \"Request changes\",\n                        icon: \"fa-solid fa-comment-dots\",\n                        target: \"command\",\n                        command: \"workflow.requestChanges\"\n                    },\n                    {\n                        id: \"approve\",\n                        label: \"Approve\",\n                        icon: \"fa-solid fa-check\",\n                        intent: \"primary\",\n                        target: \"command\",\n                        command: \"workflow.approve\"\n                    }\n                ]\n            },\n            {\n                id: \"publish\",\n                label: \"Publish\",\n                description: \"Push live once all checks pass.\",\n                icon: \"fa-solid fa-rocket\",\n                status: \"publish\",\n                blockers: [\"draftSectionsExist\"],\n                actions: [\n                    {\n                        id: \"publish-now\",\n                        label: \"Publish now\",\n                        icon: \"fa-solid fa-rocket-launch\",\n                        intent: \"primary\",\n                        target: \"command\",\n                        command: \"canvas.publish\"\n                    },\n                    {\n                        id: \"schedule-publish\",\n                        label: \"Schedule publish\",\n                        icon: \"fa-solid fa-calendar\",\n                        target: \"modal\",\n                        command: \"workflow.schedulePublish\"\n                    }\n                ]\n            }\n        ]\n    }\n};\n","export function buildSectionDescriptor(schema) {\n    const fields = schema.fields.map((field) => {\n        switch (field.type) {\n            case \"richtext\":\n                return { kind: \"richtext\", field };\n            case \"html\":\n                return { kind: \"html\", field };\n            case \"image\":\n            case \"media\":\n                return { kind: \"image\", field };\n            case \"select\":\n                return {\n                    kind: \"select\",\n                    field,\n                    options: []\n                };\n            case \"toggle\":\n                return { kind: \"toggle\", field };\n            default:\n                return { kind: \"input\", field };\n        }\n    });\n    return {\n        schema,\n        fields\n    };\n}\nexport function resolveSectionDescriptor(registry, sectionKey) {\n    const schema = registry[sectionKey];\n    if (!schema) {\n        return null;\n    }\n    return buildSectionDescriptor(schema);\n}\nexport function getSidebarCard(registry, cardId) {\n    return registry[cardId] ?? null;\n}\nexport function getWorkflow(registry, workflowId) {\n    return registry[workflowId] ?? null;\n}\n","const memoryChannels = new Map();\nfunction getMemoryChannel(name) {\n    let channel = memoryChannels.get(name);\n    if (!channel) {\n        channel = new Set();\n        memoryChannels.set(name, channel);\n    }\n    return channel;\n}\nfunction generateId() {\n    const cryptoRef = globalThis.crypto;\n    if (cryptoRef && typeof cryptoRef.randomUUID === \"function\") {\n        return cryptoRef.randomUUID();\n    }\n    return `evt_${Math.random().toString(16).slice(2)}${Date.now().toString(16)}`;\n}\nfunction nowIso() {\n    return new Date().toISOString();\n}\nfunction isBroadcastChannelAvailable() {\n    return typeof globalThis.BroadcastChannel === \"function\";\n}\nfunction isWindowAvailable() {\n    return typeof window !== \"undefined\" && typeof window.postMessage === \"function\";\n}\nexport function createEventBus(name, options = {}) {\n    const busId = options.busId ?? generateId();\n    const listeners = new Set();\n    let broadcastChannel = null;\n    let windowListener = null;\n    let memoryUnsubscribe = null;\n    const log = (level, message, context) => {\n        if (!options.logger) {\n            return;\n        }\n        try {\n            options.logger(level, message, context);\n        }\n        catch {\n            // no-op: logging must never throw\n        }\n    };\n    const dispatchLocal = (envelope) => {\n        listeners.forEach((listener) => {\n            try {\n                listener(envelope);\n            }\n            catch (error) {\n                log(\"error\", \"Event bus listener threw\", { error, envelope });\n            }\n        });\n    };\n    const handleRemote = (envelope) => {\n        if (!envelope || typeof envelope !== \"object\") {\n            return;\n        }\n        if (envelope.source === busId) {\n            return;\n        }\n        dispatchLocal(envelope);\n    };\n    if (isBroadcastChannelAvailable()) {\n        broadcastChannel = new BroadcastChannel(name);\n        broadcastChannel.addEventListener(\"message\", (event) => {\n            handleRemote(event.data);\n        });\n    }\n    else if (options.useWindowFallback !== false && isWindowAvailable()) {\n        windowListener = (event) => {\n            const data = event.data;\n            if (!data || typeof data !== \"object\" || data.__bugenceBusName !== name) {\n                return;\n            }\n            handleRemote(data.envelope);\n        };\n        window.addEventListener(\"message\", windowListener);\n    }\n    else {\n        const channel = getMemoryChannel(name);\n        const entry = {\n            busId,\n            handler: handleRemote\n        };\n        channel.add(entry);\n        memoryUnsubscribe = () => {\n            channel.delete(entry);\n            if (channel.size === 0) {\n                memoryChannels.delete(name);\n            }\n        };\n    }\n    const publish = (topic, payload) => {\n        const envelope = {\n            id: generateId(),\n            topic,\n            payload,\n            timestamp: nowIso(),\n            source: busId\n        };\n        dispatchLocal(envelope);\n        if (broadcastChannel) {\n            try {\n                broadcastChannel.postMessage(envelope);\n            }\n            catch (error) {\n                log(\"error\", \"Failed to publish via BroadcastChannel\", { error, envelope });\n            }\n        }\n        else if (windowListener && isWindowAvailable()) {\n            window.postMessage({\n                __bugenceBusName: name,\n                envelope\n            }, \"*\");\n        }\n        else {\n            const channel = memoryChannels.get(name);\n            if (channel) {\n                channel.forEach((entry) => {\n                    if (entry.busId === busId) {\n                        return;\n                    }\n                    try {\n                        entry.handler(envelope);\n                    }\n                    catch (error) {\n                        log(\"error\", \"Memory event handler threw\", { error, envelope });\n                    }\n                });\n            }\n        }\n        return envelope;\n    };\n    const subscribe = (listener) => {\n        listeners.add(listener);\n        return () => {\n            listeners.delete(listener);\n        };\n    };\n    const close = () => {\n        listeners.clear();\n        if (broadcastChannel) {\n            try {\n                broadcastChannel.close();\n            }\n            catch {\n                // ignore\n            }\n            broadcastChannel = null;\n        }\n        if (windowListener && isWindowAvailable()) {\n            window.removeEventListener(\"message\", windowListener);\n        }\n        windowListener = null;\n        if (memoryUnsubscribe) {\n            memoryUnsubscribe();\n            memoryUnsubscribe = null;\n        }\n    };\n    return {\n        publish,\n        subscribe,\n        close,\n        getId() {\n            return busId;\n        }\n    };\n}\n","const capabilityFlags = new Map();\nfunction normaliseId(id) {\n    return id.trim().toLowerCase();\n}\nfunction coerceBoolean(value) {\n    if (typeof value === \"boolean\") {\n        return value;\n    }\n    if (typeof value === \"number\") {\n        return value !== 0;\n    }\n    if (typeof value === \"string\") {\n        const trimmed = value.trim().toLowerCase();\n        if (trimmed === \"false\" || trimmed === \"0\" || trimmed === \"off\" || trimmed === \"no\") {\n            return false;\n        }\n        if (trimmed === \"true\" || trimmed === \"1\" || trimmed === \"on\" || trimmed === \"yes\") {\n            return true;\n        }\n    }\n    return Boolean(value);\n}\nexport function setCapability(id, enabled) {\n    capabilityFlags.set(normaliseId(id), enabled);\n}\nexport function enableCapability(id) {\n    setCapability(id, true);\n}\nexport function disableCapability(id) {\n    setCapability(id, false);\n}\nexport function configureCapabilities(capabilities) {\n    if (Array.isArray(capabilities)) {\n        capabilities.forEach((id) => enableCapability(id));\n        return;\n    }\n    Object.entries(capabilities).forEach(([id, value]) => {\n        setCapability(id, coerceBoolean(value));\n    });\n}\nexport function hasCapability(id) {\n    const normalised = normaliseId(id);\n    if (capabilityFlags.has(normalised)) {\n        return capabilityFlags.get(normalised) === true;\n    }\n    if (capabilityFlags.has(\"*\")) {\n        return capabilityFlags.get(\"*\") === true;\n    }\n    return true;\n}\nexport function listCapabilities() {\n    return Array.from(capabilityFlags.entries()).map(([id, enabled]) => ({\n        id,\n        enabled\n    }));\n}\nexport function clearCapabilities() {\n    capabilityFlags.clear();\n}\n","import { hasCapability } from \"../capabilities/capabilities\";\nconst metrics = new Map();\nfunction normaliseId(id) {\n    return id.trim();\n}\nfunction ensureRegistration(registration) {\n    if (!registration?.id) {\n        throw new Error(\"Metric registration requires an id.\");\n    }\n    if (typeof registration.resolve !== \"function\") {\n        throw new Error(`Metric '${registration.id}' must provide a resolve function.`);\n    }\n}\nfunction isCapabilitySatisfied(registration) {\n    if (!registration.capabilities?.length) {\n        return true;\n    }\n    return registration.capabilities.every((capability) => hasCapability(capability));\n}\nfunction defaultFormatter(result) {\n    if (result.formatted) {\n        return result;\n    }\n    const value = result.value;\n    if (value === null || value === undefined) {\n        return {\n            ...result,\n            formatted: \"--\"\n        };\n    }\n    if (typeof value === \"number\") {\n        return {\n            ...result,\n            formatted: Number.isFinite(value) ? value.toLocaleString() : String(value)\n        };\n    }\n    if (value instanceof Date) {\n        return {\n            ...result,\n            formatted: value.toISOString()\n        };\n    }\n    return {\n        ...result,\n        formatted: String(value)\n    };\n}\nexport function registerMetric(registration) {\n    ensureRegistration(registration);\n    const id = normaliseId(registration.id);\n    if (metrics.has(id)) {\n        throw new Error(`Metric '${id}' is already registered.`);\n    }\n    metrics.set(id, { registration });\n}\nexport function registerMetrics(registrations) {\n    registrations.forEach(registerMetric);\n}\nexport function unregisterMetric(id) {\n    return metrics.delete(normaliseId(id));\n}\nexport function listMetricMetas() {\n    return Array.from(metrics.values()).map((entry) => entry.registration);\n}\nexport async function resolveMetric(id, context) {\n    const entry = metrics.get(normaliseId(id));\n    if (!entry) {\n        return null;\n    }\n    if (!isCapabilitySatisfied(entry.registration)) {\n        return null;\n    }\n    const resolved = await Promise.resolve(entry.registration.resolve(context));\n    if (!resolved) {\n        return null;\n    }\n    const result = {\n        ...resolved,\n        id: resolved.id || entry.registration.id\n    };\n    const formatted = entry.registration.format?.(result, context) ?? defaultFormatter(result);\n    return formatted;\n}\nexport async function resolveMetrics(ids, context) {\n    const resolvedEntries = await Promise.all(ids.map(async (id) => {\n        const result = await resolveMetric(id, context);\n        return [id, result];\n    }));\n    return resolvedEntries.reduce((acc, [id, result]) => {\n        if (result) {\n            acc[id] = result;\n        }\n        return acc;\n    }, {});\n}\n","import {\n  sidebarCards,\n  workflowSchemas,\n  getSidebarCard,\n  getWorkflow,\n  resolveMetrics\n} from \"@bugence/core\";\n\ntype MetricKey = \"draftCount\" | \"lastPublishedAtUtc\" | \"accessibilityScore\" | \"brokenLinkCount\";\n\ninterface SidebarMetricValue {\n  raw: unknown;\n  formatted?: string;\n}\n\ntype MetricValueMap = Record<string, SidebarMetricValue>;\n\nconst METRIC_IDS: MetricKey[] = [\n  \"draftCount\",\n  \"lastPublishedAtUtc\",\n  \"accessibilityScore\",\n  \"brokenLinkCount\"\n];\n\nconst CARD_SEQUENCE = [\"publishing_overview\", \"quality_checks\", \"quick_actions\"] as const;\n\nexport function initSchemaSidebar() {\n  const root = document.querySelector<HTMLElement>(\"[data-schema-sidebar]\");\n  if (!root) {\n    return;\n  }\n\n  const cardsHost = root.querySelector<HTMLElement>(\"[data-schema-cards]\") ?? root;\n  const workflowHost = root.querySelector<HTMLElement>(\"[data-schema-workflow]\");\n\n  const sourceData = collectMetricSource(root);\n\n  void (async () => {\n    const metrics = await resolveSidebarMetricValues(root.dataset.pageId, sourceData);\n\n    CARD_SEQUENCE.forEach((cardId) => {\n      const schema = getSidebarCard(sidebarCards, cardId);\n      if (!schema) {\n        return;\n      }\n      const card = renderCard(schema, metrics);\n      cardsHost.appendChild(card);\n    });\n  })();\n\n  if (workflowHost) {\n    const workflow = getWorkflow(workflowSchemas, \"default_content_flow\");\n    if (workflow) {\n      workflowHost.appendChild(renderWorkflow(workflow));\n    }\n  }\n}\n\nfunction renderCard(schema: ReturnType<typeof getSidebarCard>, metrics: MetricValueMap) {\n  const article = document.createElement(\"article\");\n  article.className = \"tilt on-white dashboard-card animate-fadeUp\";\n\n  const cardInner = document.createElement(\"div\");\n  cardInner.className = \"dashboard-card__inner space-y-5 p-6\";\n\n  const title = document.createElement(\"div\");\n  title.innerHTML = `\n    <h3 class=\"font-display text-xl\">${schema?.title ?? \"\"}</h3>\n    ${schema?.description ? `<p class=\"text-sm text-ink/70\">${schema.description}</p>` : \"\"}\n  `;\n  cardInner.appendChild(title);\n\n  if (schema?.metrics?.length) {\n    const metricGrid = document.createElement(\"div\");\n    metricGrid.className = \"dashboard-card__metric-grid\";\n    schema.metrics.forEach((metric) => {\n      const metricValue = metric.valueField ? metrics[metric.valueField] : undefined;\n      const displayValue = metricValue\n        ? metricValue.formatted ?? formatMetric(metricValue.raw, metric.formatter)\n        : formatMetric(undefined, metric.formatter);\n      metricGrid.appendChild(\n        renderMetric(\n          metric.label,\n          displayValue,\n          metric.description,\n          metric.icon,\n          metric.emphasis\n        )\n      );\n    });\n    cardInner.appendChild(metricGrid);\n  }\n\n  if (schema?.actions?.length) {\n    const actionBar = document.createElement(\"div\");\n    actionBar.className = \"flex flex-wrap gap-3\";\n    schema.actions.forEach((action) => {\n      const button = document.createElement(\"button\");\n      button.type = \"button\";\n      button.className = [\n        \"inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-semibold transition\",\n        action.intent === \"primary\"\n          ? \"bg-black text-white hover:-translate-y-px\"\n          : action.intent === \"danger\"\n            ? \"bg-bugence-coral text-white\"\n            : \"border border-black/10 hover:bg-black/5\"\n      ].join(\" \");\n      button.dataset.command = action.command ?? \"\";\n      if (action.icon) {\n        const icon = document.createElement(\"span\");\n        icon.className = `${action.icon}`;\n        button.appendChild(icon);\n      }\n      button.appendChild(document.createTextNode(action.label));\n      actionBar.appendChild(button);\n    });\n    cardInner.appendChild(actionBar);\n  }\n\n  if (schema?.footerHint) {\n    const hint = document.createElement(\"p\");\n    hint.className = \"text-xs text-ink/50\";\n    hint.textContent = schema.footerHint;\n    cardInner.appendChild(hint);\n  }\n\n  article.appendChild(cardInner);\n  return article;\n}\n\nfunction safeNumber(value: string | undefined, fallback = 0): number {\n  if (value === undefined) {\n    return fallback;\n  }\n  const parsed = Number(value);\n  return Number.isFinite(parsed) ? parsed : fallback;\n}\n\nfunction collectMetricSource(root: HTMLElement): Record<string, unknown> {\n  return {\n    draftCount: safeNumber(root.dataset.draftCount, 0),\n    lastPublishedAtUtc: root.dataset.lastPublished ?? root.dataset.lastPublishedAtUtc ?? null,\n    accessibilityScore: safeNumber(root.dataset.accessibilityScore, 0),\n    brokenLinkCount: safeNumber(root.dataset.brokenLinkCount, 0),\n    lastSyncedAtUtc: root.dataset.lastSyncedAtUtc ?? null\n  };\n}\n\nasync function resolveSidebarMetricValues(\n  pageId: string | undefined,\n  source: Record<string, unknown>\n): Promise<MetricValueMap> {\n  try {\n    const resolved = await resolveMetrics(METRIC_IDS, {\n      pageId,\n      source: \"dashboard\",\n      data: source\n    });\n\n    const fallback = buildFallbackMetricMap(source);\n    Object.entries(resolved).forEach(([key, result]) => {\n      if (!result) {\n        return;\n      }\n      fallback[key] = {\n        raw: result.value ?? source[key],\n        formatted: result.formatted\n      };\n    });\n    return fallback;\n  } catch (error) {\n    console.error(\"[schemaSidebar] Failed to resolve metrics\", error);\n    return buildFallbackMetricMap(source);\n  }\n}\n\nfunction buildFallbackMetricMap(source: Record<string, unknown>): MetricValueMap {\n  return METRIC_IDS.reduce<MetricValueMap>((acc, key) => {\n    acc[key] = { raw: source[key] };\n    return acc;\n  }, {} as MetricValueMap);\n}\n\nfunction renderMetric(label: string, value: string, description?: string, icon?: string, emphasis: string = \"default\") {\n  const wrapper = document.createElement(\"div\");\n  wrapper.className = \"dashboard-card__metric\";\n  if (icon) {\n    const iconEl = document.createElement(\"span\");\n    iconEl.className = `${icon} text-accent`;\n    wrapper.appendChild(iconEl);\n  }\n  const labelEl = document.createElement(\"p\");\n  labelEl.className = \"dashboard-card__metric-label\";\n  labelEl.textContent = label;\n  wrapper.appendChild(labelEl);\n\n  const valueEl = document.createElement(\"p\");\n  valueEl.className = \"dashboard-card__metric-value\";\n  if (emphasis === \"warning\") {\n    valueEl.classList.add(\"text-bugence-coral\");\n  }\n  valueEl.textContent = value;\n  wrapper.appendChild(valueEl);\n\n  if (description) {\n    const desc = document.createElement(\"p\");\n    desc.className = \"dashboard-card__metric-desc\";\n    desc.textContent = description;\n    wrapper.appendChild(desc);\n  }\n\n  return wrapper;\n}\n\nfunction formatMetric(value: unknown, formatter?: string) {\n  if (value === undefined || value === null) {\n    return \"--\";\n  }\n\n  if (typeof value === \"string\") {\n    const trimmed = value.trim();\n    if (!trimmed) {\n      return \"--\";\n    }\n    if (!formatter) {\n      return trimmed;\n    }\n    value = trimmed;\n  }\n\n  if (formatter === \"percentage\") {\n    if (typeof value === \"string\" && value.includes(\"%\")) {\n      return value;\n    }\n    const numeric = typeof value === \"number\" ? value : Number(value);\n    if (Number.isFinite(numeric)) {\n      const clamped = Math.min(Math.max(numeric, 0), 1);\n      return `${Math.round(clamped * 100)}%`;\n    }\n    return String(value);\n  }\n\n  if (formatter === \"datetime\") {\n    try {\n      const date = value instanceof Date ? value : new Date(String(value));\n      return date.toLocaleString();\n    } catch {\n      return String(value);\n    }\n  }\n\n  if (formatter === \"number\") {\n    const numeric = typeof value === \"number\" ? value : Number(value);\n    if (Number.isFinite(numeric)) {\n      return numeric.toLocaleString();\n    }\n  }\n\n  return String(value);\n}\n\nfunction renderWorkflow(workflow: NonNullable<ReturnType<typeof getWorkflow>>) {\n  const wrapper = document.createElement(\"article\");\n  wrapper.className = \"tilt on-white dashboard-card animate-fadeUp\";\n\n  const inner = document.createElement(\"div\");\n  inner.className = \"dashboard-card__inner space-y-4 p-6\";\n\n  const title = document.createElement(\"div\");\n  title.innerHTML = `\n    <h3 class=\"font-display text-xl\">${workflow.title}</h3>\n    <p class=\"text-sm text-ink/70\">Track progress from draft to publish.</p>\n  `;\n  inner.appendChild(title);\n\n  const list = document.createElement(\"ol\");\n  list.className = \"space-y-3\";\n\n  workflow.steps.forEach((step) => {\n    const item = document.createElement(\"li\");\n    item.className = \"flex items-start gap-3\";\n    item.innerHTML = `\n      <span class=\"flex h-9 w-9 items-center justify-center rounded-full bg-black/5 text-black\">\n        <span class=\"${step.icon ?? \"fa-solid fa-circle-dot\"}\"></span>\n      </span>\n      <div class=\"space-y-1\">\n        <p class=\"font-semibold\">${step.label}</p>\n        ${step.description ? `<p class=\"text-xs text-ink/60\">${step.description}</p>` : \"\"}\n        ${\n          step.blockers?.length\n            ? `<p class=\"text-xs text-bugence-coral\">Blockers: ${step.blockers.join(\", \")}</p>`\n            : \"\"\n        }\n      </div>\n    `;\n    list.appendChild(item);\n  });\n\n  inner.appendChild(list);\n  wrapper.appendChild(inner);\n  return wrapper;\n}\n","import {\n  createEventBus,\n  createStore,\n  fetchHistory,\n  fetchPageCollection\n} from \"@bugence/core\";\nimport type {\n  ContentHistoryEntry,\n  ContentPageListItem,\n  DiffEnvelope,\n  IsoDateString,\n  PageCollectionResponse,\n  PublishSummary,\n  ReviewStatus,\n  SyncEventEnvelope,\n  SyncEventPayloadMap,\n  SyncEventTopic,\n  SyncTelemetryPayload,\n  Uuid\n} from \"@bugence/core\";\n\nconst SYNC_CHANNEL_NAME = \"bugence:sync\";\nconst DEFAULT_SYNC_INTERVAL_MS = 15_000;\nconst TIMELINE_EVENT_LIMIT = 40;\nconst HISTORY_TRACK_LIMIT = 200;\n\ntype TimelineTone = \"neutral\" | \"positive\" | \"warning\" | \"info\";\ntype TimelineEventSource = \"canvas\" | \"dashboard\" | \"history\" | \"workflow\";\ntype TimelineEventType =\n  | \"draft-dirty\"\n  | \"draft-synced\"\n  | \"draft-committed\"\n  | \"draft-conflict\"\n  | \"review-status\"\n  | \"publish-summary\"\n  | \"history\"\n  | \"sync-telemetry\";\n\ninterface TimelineEvent {\n  id: string;\n  timestamp: IsoDateString;\n  type: TimelineEventType;\n  title: string;\n  description?: string;\n  tone: TimelineTone;\n  source: TimelineEventSource;\n  sectionId?: Uuid;\n  sectionKey?: string;\n  reviewStatus?: ReviewStatus;\n}\n\ninterface DirtySectionState {\n  sectionId: Uuid;\n  sectionKey?: string;\n  dirty: boolean;\n  lastChangedAtUtc: IsoDateString;\n  diff?: DiffEnvelope | null;\n}\n\ninterface TimelineState {\n  events: TimelineEvent[];\n  dirtySections: Record<Uuid, DirtySectionState>;\n  reviewStatuses: Record<Uuid, ReviewStatus>;\n  conflictSectionIds: Uuid[];\n  publishSummary?: PublishSummary | null;\n  lastSyncedAtUtc?: IsoDateString | null;\n  lastSyncTelemetry?: SyncTelemetryPayload | null;\n  historyIds: string[];\n}\n\nexport interface DashboardTimelineSnapshot {\n  events: TimelineEvent[];\n  dirtySections: Record<Uuid, DirtySectionState>;\n  reviewStatuses: Record<Uuid, ReviewStatus>;\n  conflictSectionIds: Uuid[];\n  publishSummary?: PublishSummary | null;\n  lastSyncedAtUtc?: IsoDateString | null;\n  lastSyncTelemetry?: SyncTelemetryPayload | null;\n}\n\ntype HistoryKey = string;\n\ninterface HistoryBucket {\n  items: ContentHistoryEntry[];\n  etag?: string | null;\n  lastFetchedAtUtc?: string | null;\n}\n\ninterface DashboardStoreState extends Record<string, unknown> {\n  pages: ContentPageListItem[];\n  totals: PageCollectionResponse[\"totals\"] | null;\n  pagesEtag?: string | null;\n  selectedPageId?: string;\n  isLoading: boolean;\n  error?: string | null;\n  lastFetchedAtUtc?: string | null;\n  history: Record<HistoryKey, HistoryBucket>;\n  isHistoryLoading: boolean;\n  historyError?: string | null;\n  timelineByPage: Record<Uuid, TimelineState>;\n}\n\nconst initialState: DashboardStoreState = {\n  pages: [],\n  totals: null,\n  pagesEtag: undefined,\n  selectedPageId: undefined,\n  isLoading: false,\n  error: undefined,\n  lastFetchedAtUtc: undefined,\n  history: {},\n  isHistoryLoading: false,\n  historyError: undefined,\n  timelineByPage: {}\n};\n\nconst store = createStore<DashboardStoreState>(() => ({ ...initialState }));\n\nexport const dashboardStore = store;\n\nconst syncBus = createEventBus<SyncEventTopic, SyncEventPayloadMap[SyncEventTopic]>(\n  SYNC_CHANNEL_NAME,\n  {\n    logger: (level, message, context) => {\n      if (level === \"error\") {\n        console.error(\"[dashboardSync]\", message, context);\n      }\n    }\n  }\n);\n\nlet syncTimer: ReturnType<typeof setInterval> | null = null;\n\nsyncBus.subscribe(handleSyncEvent);\n\nfunction createTimelineState(): TimelineState {\n  return {\n    events: [],\n    dirtySections: {},\n    reviewStatuses: {},\n    conflictSectionIds: [],\n    publishSummary: null,\n    lastSyncedAtUtc: undefined,\n    lastSyncTelemetry: undefined,\n    historyIds: []\n  };\n}\n\nfunction trimEvents(events: TimelineEvent[]): TimelineEvent[] {\n  return events.slice(0, TIMELINE_EVENT_LIMIT);\n}\n\nfunction withTimelineState(pageId: string, updater: (current: TimelineState) => TimelineState): void {\n  store.setState((current) => {\n    const currentTimeline = current.timelineByPage[pageId] ?? createTimelineState();\n    const nextTimeline = updater(currentTimeline);\n    if (nextTimeline === currentTimeline && pageId in current.timelineByPage) {\n      return current;\n    }\n    return {\n      ...current,\n      timelineByPage: {\n        ...current.timelineByPage,\n        [pageId]: nextTimeline\n      }\n    };\n  });\n}\n\nfunction getTimelineStateSnapshot(pageId: string): TimelineState {\n  return store.getState().timelineByPage[pageId] ?? createTimelineState();\n}\n\nfunction pushTimelineEvent(pageId: string, event: TimelineEvent) {\n  withTimelineState(pageId, (current) => {\n    const filtered = current.events.filter((entry) => entry.id !== event.id);\n    return {\n      ...current,\n      events: trimEvents([event, ...filtered])\n    };\n  });\n}\n\nfunction setDirtySectionState(pageId: string, sectionId: string, nextState: DirtySectionState | null) {\n  withTimelineState(pageId, (current) => {\n    const next = { ...current.dirtySections };\n    if (!nextState || !nextState.dirty) {\n      if (!(sectionId in next)) {\n        return current;\n      }\n      delete next[sectionId];\n    } else {\n      next[sectionId] = nextState;\n    }\n    return {\n      ...current,\n      dirtySections: next\n    };\n  });\n}\n\nfunction addConflictSection(pageId: string, sectionId: string) {\n  withTimelineState(pageId, (current) => {\n    if (current.conflictSectionIds.includes(sectionId)) {\n      return current;\n    }\n    return {\n      ...current,\n      conflictSectionIds: [...current.conflictSectionIds, sectionId]\n    };\n  });\n}\n\nfunction clearConflictSection(pageId: string, sectionId: string) {\n  withTimelineState(pageId, (current) => {\n    if (!current.conflictSectionIds.includes(sectionId)) {\n      return current;\n    }\n    return {\n      ...current,\n      conflictSectionIds: current.conflictSectionIds.filter((id) => id !== sectionId)\n    };\n  });\n}\n\nfunction setReviewStatus(pageId: string, sectionId: string, status: ReviewStatus | undefined) {\n  withTimelineState(pageId, (current) => {\n    const next = { ...current.reviewStatuses };\n    if (!status) {\n      if (!(sectionId in next)) {\n        return current;\n      }\n      delete next[sectionId];\n    } else {\n      next[sectionId] = status;\n    }\n    return {\n      ...current,\n      reviewStatuses: next\n    };\n  });\n}\n\nfunction recordPublishSummary(pageId: string, summary: PublishSummary) {\n  withTimelineState(pageId, (current) => ({\n    ...current,\n    publishSummary: summary\n  }));\n}\n\nfunction recordSyncTelemetry(pageId: string, telemetry: SyncTelemetryPayload, syncedAtUtc?: IsoDateString) {\n  withTimelineState(pageId, (current) => ({\n    ...current,\n    lastSyncTelemetry: telemetry,\n    lastSyncedAtUtc:\n      telemetry.result === \"error\"\n        ? current.lastSyncedAtUtc\n        : syncedAtUtc ?? new Date().toISOString()\n  }));\n}\n\nfunction appendHistoryEntriesToTimeline(pageId: string, entries: ContentHistoryEntry[]) {\n  if (!entries.length) {\n    return;\n  }\n\n  withTimelineState(pageId, (current) => {\n    const knownIds = new Set(current.historyIds);\n    const newEvents: TimelineEvent[] = [];\n\n    entries\n      .slice()\n      .sort((a, b) => Date.parse(b.performedAtUtc) - Date.parse(a.performedAtUtc))\n      .forEach((entry) => {\n        if (knownIds.has(entry.id)) {\n          return;\n        }\n        knownIds.add(entry.id);\n        newEvents.push(buildHistoryEvent(entry));\n      });\n\n    if (newEvents.length === 0) {\n      return current;\n    }\n\n    return {\n      ...current,\n      events: trimEvents([...newEvents, ...current.events]),\n      historyIds: Array.from(knownIds).slice(-HISTORY_TRACK_LIMIT)\n    };\n  });\n}\n\nfunction cleanSectionKey(diff: DiffEnvelope | null | undefined, fallback: string): string {\n  return (\n    diff?.after?.payload.sectionKey ??\n    diff?.before?.payload.sectionKey ??\n    fallback\n  );\n}\n\nfunction resolveSectionLabel(pageId: string, sectionId: string, diff?: DiffEnvelope | null): string {\n  const candidate = cleanSectionKey(diff, sectionId);\n  if (candidate && candidate !== sectionId) {\n    return candidate;\n  }\n\n  const timeline = store.getState().timelineByPage[pageId];\n  if (timeline) {\n    const dirty = timeline.dirtySections[sectionId];\n    if (dirty?.sectionKey) {\n      return dirty.sectionKey;\n    }\n\n    const summaryEntry = timeline.publishSummary?.entries.find(\n      (entry) => entry.sectionId === sectionId\n    );\n    if (summaryEntry?.sectionKey) {\n      return summaryEntry.sectionKey;\n    }\n  }\n\n  return `Section ${sectionId.slice(0, 8)}`;\n}\n\nfunction describeDiff(diff?: DiffEnvelope | null): string | undefined {\n  if (!diff) {\n    return undefined;\n  }\n\n  const change = diff.changeType.charAt(0).toUpperCase() + diff.changeType.slice(1);\n  const contentType =\n    diff.after?.payload.contentType ?? diff.before?.payload.contentType;\n  const key = cleanSectionKey(diff, diff.sectionId);\n  const annotation = diff.annotations?.[0]?.message;\n\n  const parts = [`${change} · ${key}`];\n  if (contentType) {\n    parts.push(contentType);\n  }\n  if (annotation) {\n    parts.push(annotation);\n  }\n\n  return parts.join(\" — \");\n}\n\nfunction describeReviewStatus(status: ReviewStatus): string {\n  switch (status) {\n    case \"approved\":\n      return \"Review approved\";\n    case \"rejected\":\n      return \"Review rejected\";\n    default:\n      return \"Review requested\";\n  }\n}\n\nfunction buildHistoryEvent(entry: ContentHistoryEntry): TimelineEvent {\n  const actor = entry.performedByDisplayName ?? \"System\";\n  const scope = entry.pageSectionId\n    ? `Section ${entry.pageSectionId.slice(0, 8)}`\n    : \"Page\";\n  const diff = entry.diff ?? null;\n  const deltaFragment = diff\n    ? ` · Δ${diff.characterDelta >= 0 ? \"+\" : \"\"}${diff.characterDelta}`\n    : \"\";\n  const snippet = diff?.snippet?.trim();\n  const snippetFragment = snippet ? ` · ${snippet}` : \"\";\n\n  return {\n    id: `history:${entry.id}`,\n    timestamp: entry.performedAtUtc,\n    type: \"history\",\n    title: entry.changeSummary ?? `Updated ${entry.fieldKey}`,\n    description: `${scope} · ${actor}${deltaFragment}${snippetFragment}`,\n    tone: \"neutral\",\n    source: \"history\",\n    sectionId: entry.pageSectionId ?? undefined\n  };\n}\n\nfunction handleSyncEvent(envelope: SyncEventEnvelope) {\n  const { topic, payload, timestamp, id } = envelope;\n  const pageId = (payload as { pageId?: string }).pageId;\n  if (!pageId) {\n    return;\n  }\n\n  switch (topic) {\n    case \"snapshot.applied\": {\n      const data = payload as SyncEventPayloadMap[\"snapshot.applied\"];\n      withTimelineState(pageId, (current) => ({\n        ...current,\n        lastSyncedAtUtc: data.appliedAtUtc\n      }));\n      if (data.source === \"remote\") {\n        pushTimelineEvent(pageId, {\n          id,\n          timestamp,\n          type: \"history\",\n          title: \"Remote snapshot applied\",\n          description: \"Canvas changes pulled from server.\",\n          tone: \"info\",\n          source: \"canvas\"\n        });\n      }\n      break;\n    }\n    case \"section.changed\": {\n      const data = payload as SyncEventPayloadMap[\"section.changed\"];\n      const sectionId = data.sectionId;\n      const diff = data.diff;\n      const sectionLabel = resolveSectionLabel(pageId, sectionId, diff);\n      const previousDirty = Boolean(\n        getTimelineStateSnapshot(pageId).dirtySections[sectionId]\n      );\n\n      if (data.dirty) {\n        setDirtySectionState(pageId, sectionId, {\n          sectionId,\n          sectionKey: sectionLabel,\n          dirty: true,\n          lastChangedAtUtc: timestamp,\n          diff\n        });\n\n        if (!previousDirty) {\n          pushTimelineEvent(pageId, {\n            id,\n            timestamp,\n            type: \"draft-dirty\",\n            title: `Draft updated · ${sectionLabel}`,\n            description: describeDiff(diff),\n            tone: \"info\",\n            source: \"canvas\",\n            sectionId,\n            sectionKey: sectionLabel\n          });\n        }\n      } else {\n        if (previousDirty) {\n          pushTimelineEvent(pageId, {\n            id: `${id}:clean`,\n            timestamp,\n            type: \"draft-synced\",\n            title: `Draft aligned · ${sectionLabel}`,\n            description: \"Local changes match baseline.\",\n            tone: \"positive\",\n            source: \"canvas\",\n            sectionId,\n            sectionKey: sectionLabel\n          });\n        }\n\n        setDirtySectionState(pageId, sectionId, null);\n      }\n      break;\n    }\n    case \"section.committed\": {\n      const data = payload as SyncEventPayloadMap[\"section.committed\"];\n      const sectionId = data.sectionId;\n      const diff = data.diff;\n      const sectionLabel = resolveSectionLabel(pageId, sectionId, diff);\n\n      setDirtySectionState(pageId, sectionId, null);\n      clearConflictSection(pageId, sectionId);\n\n      pushTimelineEvent(pageId, {\n        id,\n        timestamp,\n        type: \"draft-committed\",\n        title: `Changes committed · ${sectionLabel}`,\n        description: describeDiff(diff),\n        tone: \"positive\",\n        source: \"canvas\",\n        sectionId,\n        sectionKey: sectionLabel\n      });\n      break;\n    }\n    case \"section.conflicted\": {\n      const data = payload as SyncEventPayloadMap[\"section.conflicted\"];\n      const sectionId = data.sectionId;\n      const diff = data.diff;\n      const sectionLabel = resolveSectionLabel(pageId, sectionId, diff);\n\n      addConflictSection(pageId, sectionId);\n\n      pushTimelineEvent(pageId, {\n        id,\n        timestamp,\n        type: \"draft-conflict\",\n        title: `Conflict detected · ${sectionLabel}`,\n        description: describeDiff(diff) ?? \"Resolve conflicts to continue.\",\n        tone: \"warning\",\n        source: \"canvas\",\n        sectionId,\n        sectionKey: sectionLabel\n      });\n      break;\n    }\n    case \"review.status.updated\": {\n      const data = payload as SyncEventPayloadMap[\"review.status.updated\"];\n      const sectionId = data.sectionId;\n      const sectionLabel = resolveSectionLabel(pageId, sectionId);\n\n      setReviewStatus(pageId, sectionId, data.status);\n\n      pushTimelineEvent(pageId, {\n        id,\n        timestamp,\n        type: \"review-status\",\n        title: `${describeReviewStatus(data.status)} · ${sectionLabel}`,\n        description: data.comment ?? undefined,\n        tone:\n          data.status === \"approved\"\n            ? \"positive\"\n            : data.status === \"rejected\"\n            ? \"warning\"\n            : \"info\",\n        source: \"workflow\",\n        sectionId,\n        sectionKey: sectionLabel,\n        reviewStatus: data.status\n      });\n      break;\n    }\n    case \"timeline.publish.summary\": {\n      const data = payload as SyncEventPayloadMap[\"timeline.publish.summary\"];\n      recordPublishSummary(pageId, data.summary);\n      pushTimelineEvent(pageId, {\n        id,\n        timestamp,\n        type: \"publish-summary\",\n        title: \"Publish summary ready\",\n        description: `${data.summary.entries.length} section${data.summary.entries.length === 1 ? \"\" : \"s\"} staged for release.`,\n        tone: \"info\",\n        source: \"workflow\"\n      });\n      break;\n    }\n    case \"sync.telemetry\": {\n      const data = payload as SyncEventPayloadMap[\"sync.telemetry\"];\n      const syncedAt = data.result === \"error\" ? undefined : timestamp;\n      recordSyncTelemetry(pageId, data, syncedAt);\n\n      if (data.result === \"error\") {\n        pushTimelineEvent(pageId, {\n          id,\n          timestamp,\n          type: \"sync-telemetry\",\n          title: \"Dashboard sync error\",\n          description: data.errorMessage ?? \"Sync worker reported an error.\",\n          tone: \"warning\",\n          source: data.source\n        });\n      }\n      break;\n    }\n    default:\n      break;\n  }\n}\n\nfunction isBrowser(): boolean {\n  return typeof window !== \"undefined\";\n}\n\nexport function getDashboardState(): DashboardStoreState {\n  return store.getState();\n}\n\nexport function useDashboardStore() {\n  return store;\n}\n\nexport async function loadDashboardPages(options: {\n  force?: boolean;\n  ttlMs?: number;\n} = {}): Promise<ContentPageListItem[]> {\n  const { force = false, ttlMs } = options;\n  const state = store.getState();\n\n  if (state.isLoading) {\n    return state.pages;\n  }\n\n  if (!force && state.pages.length > 0) {\n    return state.pages;\n  }\n\n  store.setState((current) => ({\n    ...current,\n    isLoading: true,\n    error: undefined\n  }));\n\n  try {\n    const result = await fetchPageCollection({\n      revalidate: force,\n      ttlMs\n    });\n\n    const pages = result.data.pages ?? [];\n    const totals = result.data.totals ?? null;\n    const etag = result.etag ?? result.data.etag ?? state.pagesEtag;\n\n    store.setState((current) => ({\n      ...current,\n      pages,\n      totals,\n      pagesEtag: etag ?? undefined,\n      isLoading: false,\n      lastFetchedAtUtc: new Date().toISOString(),\n      error: undefined\n    }));\n\n    return pages;\n  } catch (error) {\n    const message =\n      error instanceof Error ? error.message : \"Unable to load pages.\";\n\n    store.setState((current) => ({\n      ...current,\n      isLoading: false,\n      error: message\n    }));\n\n    throw error;\n  }\n}\n\nexport function selectDashboardPage(pageId?: string) {\n  store.setState((current) => ({\n    ...current,\n    selectedPageId: pageId\n  }));\n  if (pageId) {\n    withTimelineState(pageId, (currentState) => currentState);\n  }\n}\n\nexport function getSelectedDashboardPage(): ContentPageListItem | null {\n  const state = store.getState();\n  if (!state.selectedPageId) {\n    return null;\n  }\n\n  return state.pages.find((page) => page.id === state.selectedPageId) ?? null;\n}\n\nexport async function loadDashboardHistory(\n  options: {\n    pageId?: string;\n    take?: number;\n    force?: boolean;\n    ttlMs?: number;\n  } = {}\n): Promise<ContentHistoryEntry[]> {\n  const { pageId, take, force = false, ttlMs } = options;\n  const key: HistoryKey = `${pageId ?? \"all\"}:${take ?? \"default\"}`;\n  const state = store.getState();\n  const cached = state.history[key];\n\n  if (!force && cached && cached.items.length > 0) {\n    return cached.items;\n  }\n\n  store.setState((current) => ({\n    ...current,\n    isHistoryLoading: true,\n    historyError: undefined\n  }));\n\n  try {\n    const result = await fetchHistory(\n      { pageId, take },\n      { revalidate: force, ttlMs }\n    );\n\n    const historyItems = result.data.history ?? [];\n    const etag = result.etag ?? result.data.etag ?? cached?.etag;\n\n    store.setState((current) => ({\n      ...current,\n      isHistoryLoading: false,\n      history: {\n        ...current.history,\n        [key]: {\n          items: historyItems,\n          etag: etag ?? undefined,\n          lastFetchedAtUtc: new Date().toISOString()\n        }\n      }\n    }));\n\n    if (pageId) {\n      appendHistoryEntriesToTimeline(pageId, historyItems);\n    }\n\n    return historyItems;\n  } catch (error) {\n    const message =\n      error instanceof Error ? error.message : \"Unable to load history.\";\n\n    store.setState((current) => ({\n      ...current,\n      isHistoryLoading: false,\n      historyError: message\n    }));\n\n    throw error;\n  }\n}\n\nexport function getDashboardHistory(\n  pageId?: string,\n  take?: number\n): ContentHistoryEntry[] {\n  const key: HistoryKey = `${pageId ?? \"all\"}:${take ?? \"default\"}`;\n  return store.getState().history[key]?.items ?? [];\n}\n\nexport function getTimelineSnapshot(pageId?: string): DashboardTimelineSnapshot {\n  const resolvedPageId = pageId ?? store.getState().selectedPageId;\n  if (!resolvedPageId) {\n    return {\n      events: [],\n      dirtySections: {},\n      reviewStatuses: {},\n      conflictSectionIds: [],\n      publishSummary: null,\n      lastSyncedAtUtc: undefined,\n      lastSyncTelemetry: undefined\n    };\n  }\n\n  const timelineState = store.getState().timelineByPage[resolvedPageId];\n  if (!timelineState) {\n    return {\n      events: [],\n      dirtySections: {},\n      reviewStatuses: {},\n      conflictSectionIds: [],\n      publishSummary: null,\n      lastSyncedAtUtc: undefined,\n      lastSyncTelemetry: undefined\n    };\n  }\n\n  return {\n    events: [...timelineState.events],\n    dirtySections: { ...timelineState.dirtySections },\n    reviewStatuses: { ...timelineState.reviewStatuses },\n    conflictSectionIds: [...timelineState.conflictSectionIds],\n    publishSummary: timelineState.publishSummary ?? null,\n    lastSyncedAtUtc: timelineState.lastSyncedAtUtc,\n    lastSyncTelemetry: timelineState.lastSyncTelemetry\n  };\n}\n\nasync function fetchHistoryForSync(pageId: string): Promise<ContentHistoryEntry[]> {\n  const key: HistoryKey = `${pageId}:default`;\n  const state = store.getState();\n  const cached = state.history[key];\n\n  const result = await fetchHistory(\n    { pageId },\n    { revalidate: true, ttlMs: 0 }\n  );\n\n  const historyItems = result.data.history ?? [];\n  const etag = result.etag ?? result.data.etag ?? cached?.etag;\n\n  store.setState((current) => ({\n    ...current,\n    history: {\n      ...current.history,\n      [key]: {\n        items: historyItems,\n        etag: etag ?? undefined,\n        lastFetchedAtUtc: new Date().toISOString()\n      }\n    }\n  }));\n\n  return historyItems;\n}\n\nexport function startDashboardSync(options: { pageId: string; intervalMs?: number }) {\n  if (!isBrowser()) {\n    return;\n  }\n\n  const { pageId, intervalMs } = options;\n  const interval = Math.max(intervalMs ?? DEFAULT_SYNC_INTERVAL_MS, 5_000);\n\n  if (syncTimer) {\n    clearInterval(syncTimer);\n    syncTimer = null;\n  }\n\n  const runSync = async () => {\n    const startedAt = Date.now();\n    try {\n      const historyItems = await fetchHistoryForSync(pageId);\n      appendHistoryEntriesToTimeline(pageId, historyItems);\n\n      const durationMs = Date.now() - startedAt;\n      const telemetry: SyncTelemetryPayload = {\n        pageId,\n        durationMs,\n        result: \"success\",\n        source: \"dashboard\"\n      };\n\n      recordSyncTelemetry(pageId, telemetry, new Date().toISOString());\n      syncBus.publish(\"sync.telemetry\", telemetry);\n    } catch (error) {\n      const durationMs = Date.now() - startedAt;\n      const message = error instanceof Error ? error.message : String(error);\n      const telemetry: SyncTelemetryPayload = {\n        pageId,\n        durationMs,\n        result: \"error\",\n        source: \"dashboard\",\n        errorMessage: message\n      };\n\n      recordSyncTelemetry(pageId, telemetry);\n      syncBus.publish(\"sync.telemetry\", telemetry);\n    }\n  };\n\n  void runSync();\n  syncTimer = window.setInterval(runSync, interval);\n}\n\nexport function stopDashboardSync() {\n  if (syncTimer) {\n    clearInterval(syncTimer);\n    syncTimer = null;\n  }\n}\n","import type { DiffEnvelope } from \"@bugence/core\";\nimport {\n  getTimelineSnapshot,\n  selectDashboardPage,\n  startDashboardSync,\n  stopDashboardSync,\n  useDashboardStore\n} from \"../store/dashboardStore\";\nimport type { DashboardTimelineSnapshot } from \"../store/dashboardStore\";\n\ntype SnapshotEvent = DashboardTimelineSnapshot[\"events\"][number];\n\ninterface SectionCardRefs {\n  root: HTMLElement;\n  dirtyBadge?: HTMLElement;\n  conflictBadge?: HTMLElement;\n  reviewBadge?: HTMLElement;\n  reviewLabel?: HTMLElement;\n}\n\nconst SOURCE_LABEL: Record<SnapshotEvent[\"source\"], string> = {\n  canvas: \"Canvas\",\n  dashboard: \"Dashboard\",\n  history: \"History\",\n  workflow: \"Workflow\"\n};\n\nconst REVIEW_LABEL: Record<string, string> = {\n  approved: \"Approved\",\n  rejected: \"Rejected\",\n  pending: \"Pending review\"\n};\n\nexport function initTimelinePanel() {\n  const root = document.querySelector<HTMLElement>(\"[data-dashboard-timeline]\");\n  if (!root) {\n    return;\n  }\n\n  const pageId = root.getAttribute(\"data-page-id\")?.trim();\n  if (!pageId) {\n    return;\n  }\n\n  const eventsHost = root.querySelector<HTMLElement>(\"[data-timeline-events]\");\n  const emptyState = root.querySelector<HTMLElement>(\"[data-timeline-empty]\");\n  const lastSyncEl = root.querySelector<HTMLElement>(\"[data-timeline-last-sync]\");\n  const summaryList = root.querySelector<HTMLElement>(\"[data-publish-summary-list]\");\n  const summaryEmpty = root.querySelector<HTMLElement>(\"[data-publish-summary-empty]\");\n\n  const sectionCards = collectSectionCards();\n  const store = useDashboardStore();\n\n  const render = () => {\n    const snapshot = getTimelineSnapshot(pageId);\n    renderTimeline(eventsHost, emptyState, snapshot);\n    renderPublishSummary(summaryList, summaryEmpty, snapshot);\n    updateLastSync(lastSyncEl, snapshot);\n    updateSectionIndicators(sectionCards, snapshot);\n  };\n\n  const unsubscribe = store.subscribe(render);\n\n  selectDashboardPage(pageId);\n  startDashboardSync({ pageId });\n  render();\n\n  const teardown = () => {\n    unsubscribe();\n    stopDashboardSync();\n  };\n\n  window.addEventListener(\n    \"beforeunload\",\n    () => {\n      teardown();\n    },\n    { once: true }\n  );\n\n  root.addEventListener(\n    \"dashboard:timeline:dispose\",\n    () => {\n      teardown();\n    },\n    { once: true }\n  );\n}\n\nfunction collectSectionCards(): Map<string, SectionCardRefs> {\n  const map = new Map<string, SectionCardRefs>();\n  document.querySelectorAll<HTMLElement>(\"[data-editor-card]\").forEach((card) => {\n    const sectionId = card.getAttribute(\"data-section-id\");\n    if (!sectionId) {\n      return;\n    }\n\n    map.set(sectionId, {\n      root: card,\n      dirtyBadge: card.querySelector<HTMLElement>(\"[data-section-dirty-indicator]\") ?? undefined,\n      conflictBadge: card.querySelector<HTMLElement>(\"[data-section-conflict-indicator]\") ?? undefined,\n      reviewBadge: card.querySelector<HTMLElement>(\"[data-section-review-indicator]\") ?? undefined,\n      reviewLabel: card.querySelector<HTMLElement>(\"[data-section-review-label]\") ?? undefined\n    });\n  });\n  return map;\n}\n\nfunction renderTimeline(\n  host: HTMLElement | null,\n  empty: HTMLElement | null,\n  snapshot: DashboardTimelineSnapshot\n) {\n  if (!host) {\n    return;\n  }\n\n  host.innerHTML = \"\";\n  const events = snapshot.events;\n\n  if (!events.length) {\n    if (empty) {\n      empty.hidden = false;\n    }\n    return;\n  }\n\n  if (empty) {\n    empty.hidden = true;\n  }\n\n  events.forEach((event) => {\n    host.appendChild(createTimelineEventNode(event));\n  });\n}\n\nfunction createTimelineEventNode(event: SnapshotEvent): HTMLElement {\n  const article = document.createElement(\"article\");\n  article.className = \"dashboard-card__event timeline-event\";\n  article.dataset.tone = event.tone;\n  if (event.sectionKey) {\n    article.dataset.sectionKey = event.sectionKey;\n  }\n\n  const title = document.createElement(\"h3\");\n  title.className = \"dashboard-card__event-title\";\n  title.textContent = event.title;\n  article.appendChild(title);\n\n  const meta = document.createElement(\"div\");\n  meta.className = \"dashboard-card__event-meta\";\n  meta.textContent = SOURCE_LABEL[event.source] ?? \"Timeline\";\n  article.appendChild(meta);\n\n  const timestamp = document.createElement(\"time\");\n  timestamp.className = \"dashboard-card__event-timestamp\";\n  timestamp.dateTime = event.timestamp;\n  timestamp.textContent = formatEventTime(event.timestamp);\n  article.appendChild(timestamp);\n\n  if (event.description) {\n    const description = document.createElement(\"p\");\n    description.textContent = event.description;\n    article.appendChild(description);\n  }\n\n  return article;\n}\n\nfunction renderPublishSummary(\n  host: HTMLElement | null,\n  empty: HTMLElement | null,\n  snapshot: DashboardTimelineSnapshot\n) {\n  if (!host) {\n    return;\n  }\n\n  host.innerHTML = \"\";\n  const summary = snapshot.publishSummary;\n\n  if (!summary || summary.entries.length === 0) {\n    if (empty) {\n      empty.hidden = false;\n    }\n    return;\n  }\n\n  if (empty) {\n    empty.hidden = true;\n  }\n\n  summary.entries.forEach((entry) => {\n    const item = document.createElement(\"li\");\n    item.className = \"dashboard-card__event timeline-event\";\n    item.dataset.tone = entry.changeType === \"removed\" ? \"warning\" : \"info\";\n\n    const title = document.createElement(\"h3\");\n    title.className = \"dashboard-card__event-title\";\n    title.textContent = `${entry.sectionKey} · ${formatChangeType(entry.changeType)}`;\n    item.appendChild(title);\n\n    const meta = document.createElement(\"div\");\n    meta.className = \"dashboard-card__event-meta\";\n    meta.textContent = entry.contentType ?? \"Content\";\n    if (entry.reviewerStatus) {\n      const status = document.createElement(\"span\");\n      status.className = \"timeline-summary__status\";\n      status.textContent = REVIEW_LABEL[entry.reviewerStatus] ?? entry.reviewerStatus;\n      meta.appendChild(document.createTextNode(\" · \"));\n      meta.appendChild(status);\n    }\n    item.appendChild(meta);\n\n    host.appendChild(item);\n  });\n}\n\nfunction updateLastSync(element: HTMLElement | null, snapshot: DashboardTimelineSnapshot) {\n  if (!element) {\n    return;\n  }\n\n  const telemetry = snapshot.lastSyncTelemetry;\n  if (telemetry?.result === \"error\") {\n    element.dataset.state = \"error\";\n    element.textContent = `Sync error · ${telemetry.errorMessage ?? \"Check logs\"}`;\n    return;\n  }\n\n  element.removeAttribute(\"data-state\");\n\n  if (!snapshot.lastSyncedAtUtc) {\n    element.textContent = \"Awaiting first sync…\";\n    return;\n  }\n\n  element.textContent = `Last sync ${formatEventTime(snapshot.lastSyncedAtUtc)}`;\n}\n\nfunction updateSectionIndicators(\n  cards: Map<string, SectionCardRefs>,\n  snapshot: DashboardTimelineSnapshot\n) {\n  cards.forEach((refs, sectionId) => {\n    const dirtyState = snapshot.dirtySections[sectionId];\n    if (refs.dirtyBadge) {\n      const badge = refs.dirtyBadge;\n      if (dirtyState) {\n        badge.hidden = false;\n        badge.title = describeDiffShort(dirtyState.diff);\n      } else {\n        badge.hidden = true;\n        badge.removeAttribute(\"title\");\n      }\n    }\n\n    if (refs.conflictBadge) {\n      refs.conflictBadge.hidden = !snapshot.conflictSectionIds.includes(sectionId);\n    }\n\n    if (refs.reviewBadge && refs.reviewLabel) {\n      const status = snapshot.reviewStatuses[sectionId];\n      if (status) {\n        refs.reviewBadge.hidden = false;\n        refs.reviewBadge.dataset.status = status;\n        refs.reviewLabel.textContent = REVIEW_LABEL[status] ?? status;\n      } else {\n        refs.reviewBadge.hidden = true;\n        refs.reviewBadge.removeAttribute(\"data-status\");\n      }\n    }\n  });\n}\n\nfunction formatEventTime(timestamp: string): string {\n  const date = new Date(timestamp);\n  if (Number.isNaN(date.getTime())) {\n    return timestamp;\n  }\n\n  return date.toLocaleString(undefined, {\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n    second: \"2-digit\"\n  });\n}\n\nfunction describeDiffShort(diff?: DiffEnvelope | null): string {\n  if (!diff) {\n    return \"Draft updated\";\n  }\n\n  const change = diff.changeType.charAt(0).toUpperCase() + diff.changeType.slice(1);\n  const key =\n    diff.after?.payload.sectionKey ??\n    diff.before?.payload.sectionKey ??\n    diff.sectionId;\n\n  return `${change} · ${key}`;\n}\n\nfunction formatChangeType(change: DiffEnvelope[\"changeType\"]): string {\n  return change.charAt(0).toUpperCase() + change.slice(1);\n}\n","import {\n  fetchSections,\n  type ContentHistoryEntry,\n  type ContentPageListItem,\n  type IsoDateString,\n  type PageSectionWithHistory\n} from \"@bugence/core\";\nimport {\n  getDashboardHistory,\n  getDashboardState,\n  loadDashboardHistory,\n  loadDashboardPages\n} from \"../store/dashboardStore\";\n\ntype SortKey = \"recent\" | \"sections\" | \"alphabetical\";\ntype FilterKey = \"all\" | \"fresh\" | \"stale\" | \"unpublished\";\n\ninterface LibraryState {\n  pages: ContentPageListItem[];\n  sort: SortKey;\n  filter: FilterKey;\n  search: string;\n}\n\ninterface LibraryMetricsRefs {\n  totalPages?: HTMLElement | null;\n  totalSections?: HTMLElement | null;\n  activePastWeek?: HTMLElement | null;\n  latestUpdate?: HTMLElement | null;\n}\n\ninterface StatusMetricRefs {\n  root: HTMLElement;\n  value: HTMLElement | null;\n  meter: HTMLElement | null;\n  kind: string;\n}\n\ninterface InspectorSection {\n  id: string;\n  sectionKey?: string | null;\n  title?: string | null;\n  contentType: string;\n  updatedAtUtc: IsoDateString;\n  lastPublishedAtUtc?: IsoDateString | null;\n}\n\ninterface InspectorServices {\n  loadSections(pageId: string): Promise<InspectorSection[]>;\n  loadActivity(pageId: string): Promise<ContentHistoryEntry[]>;\n}\n\nconst FRESH_THRESHOLD_HOURS = 48;\nconst STALE_THRESHOLD_DAYS = 14;\n\nconst DATE_FULL = new Intl.DateTimeFormat(undefined, {\n  month: \"short\",\n  day: \"2-digit\",\n  year: \"numeric\"\n});\n\nconst DATE_TIME_SHORT = new Intl.DateTimeFormat(undefined, {\n  month: \"short\",\n  day: \"2-digit\",\n  hour: \"2-digit\",\n  minute: \"2-digit\"\n});\n\nconst TIME_ONLY = new Intl.DateTimeFormat(undefined, {\n  hour: \"2-digit\",\n  minute: \"2-digit\"\n});\n\nexport function initLibraryConsole() {\n  const root = document.querySelector<HTMLElement>(\"[data-library-console]\");\n  if (!root) {\n    return;\n  }\n\n  const metricsRefs: LibraryMetricsRefs = {\n    totalPages: root.querySelector<HTMLElement>('[data-library-metric=\"totalPages\"]'),\n    totalSections: root.querySelector<HTMLElement>('[data-library-metric=\"totalSections\"]'),\n    activePastWeek: root.querySelector<HTMLElement>('[data-library-metric=\"activePastWeek\"]'),\n    latestUpdate: root.querySelector<HTMLElement>('[data-library-metric=\"latestUpdate\"]')\n  };\n\n  const badgeCount = root.querySelector<HTMLElement>(\"[data-library-count]\");\n  const pageGrid = root.querySelector<HTMLElement>(\"[data-library-page-list]\");\n  const emptyState = root.querySelector<HTMLElement>(\"[data-library-empty]\");\n  const trendingHost = root.querySelector<HTMLElement>(\"[data-library-trending] .library-console__chip-stack\");\n  const controlsHost = root.querySelector<HTMLElement>(\"[data-library-controls]\");\n  const searchInput =\n    root.querySelector<HTMLInputElement>(\"#term\") ?? document.getElementById(\"term\") as HTMLInputElement | null;\n\n  const statusRefs: StatusMetricRefs[] = Array.from(\n    root.querySelectorAll<HTMLElement>(\"[data-library-status]\")\n  ).map((element) => ({\n    root: element,\n    kind: (element.dataset.statusKind ?? \"\").trim(),\n    value: element.querySelector<HTMLElement>(\"strong\"),\n    meter: element.querySelector<HTMLElement>(\".library-console__status-meter span\")\n  }));\n\n  const inspectorRoot = document.querySelector<HTMLElement>(\"[data-library-inspector]\");\n  const inspector = inspectorRoot\n    ? createInspector(inspectorRoot, {\n        loadSections: createSectionsLoader(),\n        loadActivity: createActivityLoader()\n      })\n    : null;\n\n  const state: LibraryState = {\n    pages: pageGrid ? extractPagesFromDom(pageGrid) : [],\n    sort: \"recent\",\n    filter: \"all\",\n    search: (searchInput?.value ?? \"\").trim()\n  };\n\n  state.pages = state.pages.map((page) => normalizePageItem(page));\n\n  if (!pageGrid) {\n    console.warn(\"[libraryConsole] Page grid container not found, skipping enhancements.\");\n    return;\n  }\n\n  const applyRender = () => renderLibrary({\n    root,\n    state,\n    pageGrid,\n    emptyState,\n    badgeCount,\n    metricsRefs,\n    statusRefs,\n    trendingHost\n  });\n\n  applyRender();\n\n  void loadDashboardPages({ force: true, ttlMs: 60_000 })\n    .then(() => {\n      const store = getDashboardState();\n      state.pages = store.pages.map((page) => normalizePageItem(page));\n      applyRender();\n    })\n    .catch((error) => {\n      console.warn(\"[libraryConsole] Unable to refresh pages\", error);\n    });\n\n  if (searchInput) {\n    searchInput.addEventListener(\"input\", () => {\n      state.search = searchInput.value.trim();\n      applyRender();\n    });\n  }\n\n  root.addEventListener(\"click\", (event) => {\n    const target = event.target as HTMLElement | null;\n    if (!target) {\n      return;\n    }\n\n    const chip = target.closest<HTMLElement>(\"[data-library-chip]\");\n    if (chip && searchInput) {\n      event.preventDefault();\n      const term = chip.dataset.libraryTerm ?? chip.textContent?.trim() ?? \"\";\n      searchInput.value = term;\n      state.search = term;\n      applyRender();\n      return;\n    }\n\n    const inspectButton = target.closest<HTMLElement>(\"[data-library-inspect]\");\n    if (inspectButton && inspector) {\n      event.preventDefault();\n      const pageId = inspectButton.getAttribute(\"data-library-inspect\");\n      if (!pageId) {\n        return;\n      }\n\n      const page = state.pages.find((entry) => entry.id === pageId);\n      if (!page) {\n        return;\n      }\n\n      inspector.open(page, inspectButton);\n    }\n  });\n\n  if (controlsHost) {\n    updateActiveControl(controlsHost, \"[data-library-sort]\", state.sort);\n    updateActiveControl(controlsHost, \"[data-library-filter]\", state.filter);\n\n    controlsHost.addEventListener(\"click\", (event) => {\n      const target = event.target as HTMLElement | null;\n      if (!target) {\n        return;\n      }\n\n      const sortButton = target.closest<HTMLElement>(\"[data-library-sort]\");\n      if (sortButton) {\n        const sortKey = sortButton.getAttribute(\"data-library-sort\") as SortKey;\n        if (sortKey && state.sort !== sortKey) {\n          state.sort = sortKey;\n          updateActiveControl(controlsHost, \"[data-library-sort]\", sortKey);\n          applyRender();\n        }\n        return;\n      }\n\n      const filterButton = target.closest<HTMLElement>(\"[data-library-filter]\");\n      if (filterButton) {\n        const filterKey = filterButton.getAttribute(\"data-library-filter\") as FilterKey;\n        if (filterKey && state.filter !== filterKey) {\n          state.filter = filterKey;\n          updateActiveControl(controlsHost, \"[data-library-filter]\", filterKey);\n          applyRender();\n        }\n      }\n    });\n  }\n}\n\nfunction renderLibrary(context: {\n  root: HTMLElement;\n  state: LibraryState;\n  pageGrid: HTMLElement;\n  emptyState: HTMLElement | null;\n  badgeCount: HTMLElement | null;\n  metricsRefs: LibraryMetricsRefs;\n  statusRefs: StatusMetricRefs[];\n  trendingHost: HTMLElement | null;\n  }) {\n    const { state, pageGrid, emptyState, badgeCount, metricsRefs, statusRefs, trendingHost } = context;\n    const pages = state.pages.map((page) => normalizePageItem(page));\n    const totalCount = pages.length;\n\n  const filtered = pages\n    .filter((page) => filterPage(page, state.filter))\n    .filter((page) => matchesSearch(page, state.search));\n\n  sortPages(filtered, state.sort);\n\n  renderPageCards(pageGrid, filtered);\n\n  if (emptyState) {\n    emptyState.hidden = filtered.length > 0;\n  }\n\n  pageGrid.hidden = filtered.length === 0;\n\n  if (badgeCount) {\n    badgeCount.textContent =\n      filtered.length === totalCount\n        ? totalCount.toString()\n        : `${filtered.length} / ${totalCount}`;\n  }\n\n  updateHeroMetrics(metricsRefs, pages);\n  updateStatusMetrics(statusRefs, pages);\n  renderTrending(trendingHost, pages);\n}\n\nfunction filterPage(page: ContentPageListItem, filter: FilterKey): boolean {\n  if (filter === \"all\") {\n    return true;\n  }\n\n    const updatedAt = new Date(page.updatedAtUtc);\n    const hasValidUpdatedAt = !Number.isNaN(updatedAt.getTime());\n    const lastPublished = page.lastPublishedAtUtc ? new Date(page.lastPublishedAtUtc) : null;\n    const hasValidPublishedAt = lastPublished ? !Number.isNaN(lastPublished.getTime()) : false;\n\n    switch (filter) {\n      case \"fresh\":\n        return hasValidUpdatedAt && hoursSince(updatedAt) <= FRESH_THRESHOLD_HOURS;\n      case \"stale\":\n        return hasValidUpdatedAt && hoursSince(updatedAt) >= STALE_THRESHOLD_DAYS * 24;\n      case \"unpublished\":\n        return !hasValidPublishedAt;\n      default:\n        return true;\n    }\n  }\n\nfunction matchesSearch(page: ContentPageListItem, search: string): boolean {\n  if (!search) {\n    return true;\n  }\n\n  const haystack = `${page.name ?? \"\"} ${page.slug ?? \"\"} ${page.description ?? \"\"}`.toLowerCase();\n  return haystack.includes(search.toLowerCase());\n}\n\nfunction sortPages(pages: ContentPageListItem[], sort: SortKey) {\n  switch (sort) {\n    case \"sections\":\n      pages.sort((a, b) => b.sectionCount - a.sectionCount || a.name.localeCompare(b.name));\n      break;\n    case \"alphabetical\":\n      pages.sort((a, b) => a.name.localeCompare(b.name));\n      break;\n    case \"recent\":\n    default:\n      pages.sort(\n        (a, b) =>\n          new Date(b.updatedAtUtc).getTime() - new Date(a.updatedAtUtc).getTime()\n      );\n      break;\n  }\n}\n\nfunction renderPageCards(container: HTMLElement, pages: ContentPageListItem[]) {\n  container.innerHTML = \"\";\n  if (!pages.length) {\n    return;\n  }\n\n  const fragment = document.createDocumentFragment();\n  pages.forEach((page) => {\n    fragment.appendChild(createPageCard(page));\n  });\n  container.appendChild(fragment);\n}\n\nfunction createPageCard(page: ContentPageListItem): HTMLElement {\n  const article = document.createElement(\"article\");\n  article.className = \"library-console__page-card\";\n  article.dataset.pageId = page.id;\n  article.dataset.pageName = page.name;\n  article.dataset.pageSlug = page.slug;\n  if (page.description) {\n    article.dataset.pageDescription = page.description;\n  }\n  article.dataset.pageUpdated = page.updatedAtUtc;\n  if (page.lastPublishedAtUtc) {\n    article.dataset.pagePublished = page.lastPublishedAtUtc;\n  }\n  article.dataset.pageSections = String(page.sectionCount);\n  article.dataset.pageText = String(page.textSections);\n  article.dataset.pageImages = String(page.imageSections);\n\n  const header = document.createElement(\"header\");\n  header.className = \"library-console__page-header\";\n  const slug = document.createElement(\"span\");\n  slug.className = \"library-console__page-slug\";\n  slug.textContent = page.slug;\n  const title = document.createElement(\"h3\");\n  title.textContent = page.name;\n  const description = document.createElement(\"p\");\n  description.textContent = page.description ?? \"No description yet.\";\n  header.append(slug, title, description);\n\n  const metrics = document.createElement(\"dl\");\n  metrics.className = \"library-console__page-metrics\";\n  metrics.append(\n    createMetricEntry(\"Sections\", page.sectionCount),\n    createMetricEntry(\"Text frames\", page.textSections),\n    createMetricEntry(\"Imagery slots\", page.imageSections)\n  );\n\n  const footer = document.createElement(\"footer\");\n  footer.className = \"library-console__page-footer\";\n  const meta = document.createElement(\"div\");\n  const updatedLabel = document.createElement(\"span\");\n  updatedLabel.className = \"library-console__timestamp-label\";\n  updatedLabel.textContent = \"Updated\";\n  const updatedTime = document.createElement(\"time\");\n  updatedTime.className = \"library-console__timestamp\";\n  updatedTime.dateTime = page.updatedAtUtc;\n  updatedTime.textContent = formatFullDate(page.updatedAtUtc);\n  const updatedSecondary = document.createElement(\"span\");\n  updatedSecondary.className = \"library-console__timestamp-secondary\";\n  updatedSecondary.textContent = `${formatTimeOnly(page.updatedAtUtc)} local`;\n\n  const publishedLabel = document.createElement(\"span\");\n  publishedLabel.className = \"library-console__timestamp-secondary library-console__timestamp-secondary--published\";\n  publishedLabel.textContent = `Last publish: ${page.lastPublishedAtUtc ? formatFullDate(page.lastPublishedAtUtc) : \"Draft only\"}`;\n\n  meta.append(updatedLabel, updatedTime, updatedSecondary, publishedLabel);\n\n  const actions = document.createElement(\"div\");\n  actions.className = \"library-console__page-actions\";\n\n  actions.append(\n    createActionLink(`/content/canvas/${page.id}`, \"library-console__action\", \"fa-solid fa-pen-to-square\", \"Edit\", true),\n    createActionLink(`/Content/LivePreview?pageId=${encodeURIComponent(page.id)}`, \"library-console__action library-console__action--ghost\", \"fa-solid fa-eye\", \"Preview\"),\n    createDetailButton(page.id)\n  );\n\n  footer.append(meta, actions);\n  article.append(header, metrics, footer);\n  return article;\n}\n\nfunction createMetricEntry(label: string, value: number): HTMLElement {\n  const wrapper = document.createElement(\"div\");\n  const dt = document.createElement(\"dt\");\n  dt.textContent = label;\n  const dd = document.createElement(\"dd\");\n  dd.textContent = value.toString();\n  wrapper.append(dt, dd);\n  return wrapper;\n}\n\nfunction createActionLink(\n  href: string,\n  className: string,\n  iconClass: string,\n  label: string,\n  external = false\n): HTMLElement {\n  const anchor = document.createElement(\"a\");\n  anchor.href = href;\n  anchor.className = className;\n  if (external) {\n    anchor.target = \"_blank\";\n    anchor.rel = \"noopener\";\n  }\n  const icon = document.createElement(\"span\");\n  icon.className = iconClass;\n  anchor.append(icon, document.createTextNode(label));\n  return anchor;\n}\n\nfunction createDetailButton(pageId: string): HTMLElement {\n  const button = document.createElement(\"button\");\n  button.type = \"button\";\n  button.className = \"library-console__action library-console__action--detail\";\n  button.setAttribute(\"data-library-inspect\", pageId);\n  const icon = document.createElement(\"span\");\n  icon.className = \"fa-solid fa-circle-info\";\n  const label = document.createTextNode(\"Details\");\n  button.append(icon, label);\n  return button;\n}\n\nfunction updateHeroMetrics(refs: LibraryMetricsRefs, pages: ContentPageListItem[]) {\n  const totals = pages.reduce(\n    (acc, page) => {\n      acc.sectionCount += page.sectionCount;\n      acc.textSections += page.textSections;\n      acc.imageSections += page.imageSections;\n      if (page.updatedAtUtc > acc.latestUpdateUtc) {\n        acc.latestUpdateUtc = page.updatedAtUtc;\n      }\n      if (hoursSince(new Date(page.updatedAtUtc)) <= 7 * 24) {\n        acc.activePastWeek += 1;\n      }\n      return acc;\n    },\n    {\n      pageCount: pages.length,\n      sectionCount: 0,\n      textSections: 0,\n      imageSections: 0,\n      activePastWeek: 0,\n      latestUpdateUtc: \"\"\n    }\n  );\n\n  if (refs.totalPages) {\n    refs.totalPages.textContent = totals.pageCount.toString();\n  }\n  if (refs.totalSections) {\n    refs.totalSections.textContent = totals.sectionCount.toString();\n  }\n  if (refs.activePastWeek) {\n    refs.activePastWeek.textContent = totals.activePastWeek.toString();\n  }\n  if (refs.latestUpdate) {\n    if (totals.latestUpdateUtc) {\n      refs.latestUpdate.dataset.libraryLatest = totals.latestUpdateUtc;\n      refs.latestUpdate.textContent = `${formatFullDate(totals.latestUpdateUtc)} · ${formatTimeOnly(totals.latestUpdateUtc)}`;\n    } else {\n      refs.latestUpdate.dataset.libraryLatest = \"\";\n      refs.latestUpdate.textContent = \"Awaiting first publish\";\n    }\n  }\n}\n\nfunction updateStatusMetrics(refs: StatusMetricRefs[], pages: ContentPageListItem[]) {\n  const counts = pages.reduce<Record<string, number>>((acc, page) => {\n    if (page.sectionCount > 0) {\n      acc[\"Launch ready\"] = (acc[\"Launch ready\"] ?? 0) + 1;\n    }\n    if (hoursSince(new Date(page.updatedAtUtc)) <= FRESH_THRESHOLD_HOURS) {\n      acc[\"In review\"] = (acc[\"In review\"] ?? 0) + 1;\n    }\n    if ((page.description ?? \"\").toLowerCase().includes(\"test\")) {\n      acc[\"Experimenting\"] = (acc[\"Experimenting\"] ?? 0) + 1;\n    }\n    return acc;\n  }, {});\n\n  refs.forEach(({ root, value, meter, kind }) => {\n    const total = pages.length || 1;\n    const nextValue = counts[kind] ?? 0;\n    if (value) {\n      value.textContent = nextValue.toString();\n    }\n    if (meter) {\n      const ratio = Math.max(0, Math.min(1, nextValue / total));\n      meter.style.width = `${Math.round(ratio * 100)}%`;\n    }\n    root.dataset.state = nextValue > 0 ? \"active\" : \"idle\";\n  });\n}\n\nfunction renderTrending(host: HTMLElement | null, pages: ContentPageListItem[]) {\n  if (!host) {\n    return;\n  }\n\n  const top = [...pages]\n    .sort((a, b) => new Date(b.updatedAtUtc).getTime() - new Date(a.updatedAtUtc).getTime())\n    .slice(0, 3);\n\n  host.innerHTML = \"\";\n  if (!top.length) {\n    return;\n  }\n\n  top.forEach((page) => {\n    const anchor = document.createElement(\"a\");\n    anchor.href = `/Content/Library?term=${encodeURIComponent(page.name)}`;\n    anchor.className = \"library-console__chip\";\n    anchor.dataset.libraryChip = \"\";\n    anchor.dataset.libraryTerm = page.name;\n    anchor.dataset.pageId = page.id;\n    anchor.dataset.pageUpdated = page.updatedAtUtc;\n\n    const icon = document.createElement(\"span\");\n    icon.className = \"fa-solid fa-sparkles\";\n    icon.setAttribute(\"aria-hidden\", \"true\");\n\n    const label = document.createTextNode(page.name);\n    const meta = document.createElement(\"span\");\n    meta.className = \"library-console__chip-meta\";\n    meta.textContent = `${formatDateTimeShort(page.updatedAtUtc)}`;\n\n    anchor.append(icon, label, meta);\n    host.appendChild(anchor);\n  });\n}\n\nfunction updateActiveControl(host: HTMLElement, selector: string, value: string) {\n  host.querySelectorAll<HTMLElement>(selector).forEach((element) => {\n    const key = element.getAttribute(selector.replace(/[\\[\\]]/g, \"\").split(\"=\")[0]) ?? \"\";\n    if (key === value) {\n      element.dataset.state = \"active\";\n    } else {\n      element.dataset.state = \"idle\";\n    }\n  });\n}\n\nfunction extractPagesFromDom(container: HTMLElement): ContentPageListItem[] {\n  const items: ContentPageListItem[] = [];\n\n  container.querySelectorAll<HTMLElement>(\"[data-page-id]\").forEach((node) => {\n    const raw: Record<string, unknown> = {\n      id: node.dataset.pageId ?? \"\",\n      name: node.dataset.pageName ?? node.querySelector(\"h3\")?.textContent ?? \"\",\n      slug:\n        node.dataset.pageSlug ??\n        node.querySelector(\"[data-page-slug], .library-console__page-slug\")?.textContent ??\n        \"\",\n      description:\n        node.dataset.pageDescription ??\n        node.querySelector(\"[data-page-description], p\")?.textContent ??\n        \"\",\n      updatedAtUtc: node.dataset.pageUpdated ?? \"\",\n      lastPublishedAtUtc: node.dataset.pagePublished && node.dataset.pagePublished.trim().length > 0\n        ? node.dataset.pagePublished\n        : null,\n      sectionCount: node.dataset.pageSections,\n      textSections: node.dataset.pageText,\n      imageSections: node.dataset.pageImages\n    };\n\n    items.push(normalizePageItem(raw));\n  });\n\n  return items;\n}\n\nfunction normalizePageItem(raw: ContentPageListItem | Record<string, unknown>): ContentPageListItem {\n  const source = raw as Record<string, unknown>;\n\n  const name = ensureString(pick(source, \"name\", \"Name\"), \"Untitled page\");\n  const slug = ensureSlug(pick(source, \"slug\", \"Slug\"), name);\n\n  const updatedSource = pick(source, \"updatedAtUtc\", \"UpdatedAtUtc\", \"updatedAt\", \"UpdatedAt\");\n  const publishedSource = pick(source, \"lastPublishedAtUtc\", \"LastPublishedAtUtc\", \"publishedAtUtc\", \"PublishedAtUtc\");\n\n  const updatedIso = ensureIsoString(updatedSource, new Date().toISOString());\n  const publishedIso =\n    publishedSource === null ||\n    publishedSource === undefined ||\n    (typeof publishedSource === \"string\" && publishedSource.trim().length === 0)\n      ? null\n      : ensureIsoString(publishedSource, updatedIso);\n\n  return {\n    id: ensureId(pick(source, \"id\", \"Id\"), slug, name),\n    name,\n    slug,\n    description: ensureString(pick(source, \"description\", \"Description\"), \"\"),\n    updatedAtUtc: updatedIso,\n    lastPublishedAtUtc: publishedIso,\n    sectionCount: ensureNumber(pick(source, \"sectionCount\", \"SectionCount\")),\n    textSections: ensureNumber(pick(source, \"textSections\", \"TextSections\")),\n    imageSections: ensureNumber(pick(source, \"imageSections\", \"ImageSections\"))\n  };\n}\n\nfunction ensureString(value: unknown, fallback = \"\"): string {\n  if (typeof value === \"string\") {\n    const trimmed = value.trim();\n    if (trimmed.length > 0) {\n      return trimmed;\n    }\n  }\n  return fallback;\n}\n\nfunction ensureIsoString(value: unknown, fallback: string): IsoDateString {\n  if (value instanceof Date) {\n    return value.toISOString() as IsoDateString;\n  }\n\n  if (typeof value === \"number\" && Number.isFinite(value)) {\n    return new Date(value).toISOString() as IsoDateString;\n  }\n\n  if (typeof value === \"string\") {\n    const trimmed = value.trim();\n    if (trimmed.length > 0) {\n      const parsed = new Date(trimmed);\n      if (!Number.isNaN(parsed.getTime())) {\n        return trimmed as IsoDateString;\n      }\n    }\n  }\n\n  const parsedFallback = new Date(fallback);\n  return (Number.isNaN(parsedFallback.getTime()) ? new Date() : parsedFallback).toISOString() as IsoDateString;\n}\n\nfunction ensureNumber(value: unknown, fallback = 0): number {\n  if (typeof value === \"number\" && Number.isFinite(value)) {\n    return value;\n  }\n\n  if (typeof value === \"string\") {\n    const trimmed = value.trim();\n    if (trimmed.length > 0) {\n      const parsed = Number.parseInt(trimmed, 10);\n      if (Number.isFinite(parsed)) {\n        return parsed;\n      }\n    }\n  }\n\n  return fallback;\n}\n\nfunction pick(source: Record<string, unknown>, ...keys: string[]): unknown {\n  for (const key of keys) {\n    const candidate = source[key];\n    if (candidate !== undefined && candidate !== null) {\n      return candidate;\n    }\n  }\n  return undefined;\n}\n\nfunction ensureSlug(candidate: unknown, name: string): string {\n  const slugCandidate = ensureString(candidate ?? \"\", \"\");\n  if (slugCandidate) {\n    return slugCandidate;\n  }\n\n  const derived = name\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, \"-\")\n    .replace(/^-+|-+$/g, \"\")\n    .slice(0, 60);\n\n  return derived || `page-${Math.random().toString(36).slice(2, 10)}`;\n}\n\nfunction ensureId(candidate: unknown, slug: string, name: string): string {\n  const idCandidate = ensureString(candidate ?? \"\", \"\");\n  if (idCandidate) {\n    return idCandidate;\n  }\n\n  if (slug) {\n    return slug;\n  }\n\n  const fallback = name\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, \"-\")\n    .replace(/^-+|-+$/g, \"\");\n\n  return fallback || `page-${Date.now().toString(36)}${Math.random().toString(36).slice(2, 6)}`;\n}\n\nfunction hoursSince(date: Date): number {\n  return (Date.now() - date.getTime()) / 36e5;\n}\n\nfunction formatFullDate(value: IsoDateString): string {\n  const date = new Date(value);\n  return Number.isNaN(date.getTime()) ? value : DATE_FULL.format(date);\n}\n\nfunction formatDateTimeShort(value: IsoDateString): string {\n  const date = new Date(value);\n  return Number.isNaN(date.getTime()) ? value : DATE_TIME_SHORT.format(date);\n}\n\nfunction formatTimeOnly(value: IsoDateString): string {\n  const date = new Date(value);\n  return Number.isNaN(date.getTime()) ? value : TIME_ONLY.format(date);\n}\n\nfunction createSectionsLoader(): InspectorServices[\"loadSections\"] {\n  const cache = new Map<string, InspectorSection[]>();\n  return async (pageId) => {\n    if (cache.has(pageId)) {\n      return cache.get(pageId) ?? [];\n    }\n\n    try {\n      const result = await fetchSections(pageId, { revalidate: true, ttlMs: 0 });\n      const sections = (result.data.sections ?? []).map(mapSectionForInspector);\n      cache.set(pageId, sections);\n      return sections;\n    } catch (error) {\n      console.warn(\"[libraryConsole] Unable to load sections for inspector\", error);\n      cache.set(pageId, []);\n      return [];\n    }\n  };\n}\n\nfunction createActivityLoader(): InspectorServices[\"loadActivity\"] {\n  const cache = new Map<string, ContentHistoryEntry[]>();\n  return async (pageId) => {\n    if (cache.has(pageId)) {\n      return cache.get(pageId) ?? [];\n    }\n\n    try {\n      await loadDashboardHistory({ pageId, take: 8, force: true, ttlMs: 0 });\n      const history = getDashboardHistory(pageId, 8);\n      cache.set(pageId, history);\n      return history;\n    } catch (error) {\n      console.warn(\"[libraryConsole] Unable to load history for inspector\", error);\n      cache.set(pageId, []);\n      return [];\n    }\n  };\n}\n\nfunction mapSectionForInspector(section: PageSectionWithHistory): InspectorSection {\n  return {\n    id: section.id,\n    sectionKey: section.sectionKey,\n    title: section.title,\n    contentType: section.contentType,\n    updatedAtUtc: section.updatedAtUtc,\n    lastPublishedAtUtc: section.lastPublishedAtUtc ?? null\n  };\n}\n\nfunction createInspector(root: HTMLElement, services: InspectorServices) {\n  const slugEl = root.querySelector<HTMLElement>(\"[data-library-inspector-slug]\");\n  const titleEl = root.querySelector<HTMLElement>(\"[data-library-inspector-title]\");\n  const descriptionEl = root.querySelector<HTMLElement>(\"[data-library-inspector-description]\");\n  const sectionsEl = root.querySelector<HTMLElement>(\"[data-library-inspector-sections]\");\n  const textEl = root.querySelector<HTMLElement>(\"[data-library-inspector-text]\");\n  const imagesEl = root.querySelector<HTMLElement>(\"[data-library-inspector-images]\");\n  const signalsList = root.querySelector<HTMLElement>(\"[data-library-inspector-signals]\");\n  const sectionList = root.querySelector<HTMLElement>(\"[data-library-inspector-section-list]\");\n  const activityList = root.querySelector<HTMLElement>(\"[data-library-inspector-activity]\");\n  const tabs = Array.from(root.querySelectorAll<HTMLButtonElement>(\"[data-library-inspector-tabs] [data-tab]\"));\n  const panels = Array.from(root.querySelectorAll<HTMLElement>(\"[data-library-inspector-panels] [data-panel]\"));\n  const closers = root.querySelectorAll<HTMLElement>(\"[data-library-close]\");\n\n  let lastTrigger: HTMLElement | null = null;\n  let activeTab = \"summary\";\n\n  tabs.forEach((tab) => {\n    tab.addEventListener(\"click\", () => {\n      const next = tab.getAttribute(\"data-tab\");\n      if (!next || next === activeTab) {\n        return;\n      }\n      activeTab = next;\n      updateInspectorTabs(tabs, panels, activeTab);\n    });\n  });\n\n  closers.forEach((closer) => {\n    closer.addEventListener(\"click\", () => hide());\n  });\n\n  root.addEventListener(\"keydown\", (event) => {\n    if (event.key === \"Escape\") {\n      hide();\n    }\n  });\n\n  function open(page: ContentPageListItem, trigger: HTMLElement) {\n    lastTrigger = trigger;\n    activeTab = \"summary\";\n    updateInspectorTabs(tabs, panels, activeTab);\n\n    renderSummary(page);\n    void renderSections(page.id);\n    void renderActivity(page.id);\n\n    root.hidden = false;\n    requestAnimationFrame(() => {\n      root.dataset.state = \"open\";\n      const closeButton = root.querySelector<HTMLButtonElement>(\".library-inspector__close\");\n      closeButton?.focus({ preventScroll: true });\n      document.body.style.setProperty(\"overflow\", \"hidden\");\n    });\n  }\n\n  function hide() {\n    root.dataset.state = \"idle\";\n    document.body.style.removeProperty(\"overflow\");\n    setTimeout(() => {\n      root.hidden = true;\n      if (lastTrigger) {\n        lastTrigger.focus({ preventScroll: true });\n      }\n    }, 180);\n  }\n\n  function renderSummary(page: ContentPageListItem) {\n    if (slugEl) slugEl.textContent = page.slug ?? \"\";\n    if (titleEl) titleEl.textContent = page.name ?? \"\";\n    if (descriptionEl) {\n      descriptionEl.textContent = page.description ?? \"No description captured yet.\";\n    }\n    if (sectionsEl) sectionsEl.textContent = page.sectionCount.toString();\n    if (textEl) textEl.textContent = page.textSections.toString();\n    if (imagesEl) imagesEl.textContent = page.imageSections.toString();\n    if (signalsList) {\n      signalsList.innerHTML = \"\";\n      const signals = buildSummarySignals(page);\n      signals.forEach((signal) => {\n        const item = document.createElement(\"li\");\n        item.textContent = signal;\n        signalsList.appendChild(item);\n      });\n    }\n  }\n\n  async function renderSections(pageId: string) {\n    if (!sectionList) return;\n    sectionList.innerHTML = \"\";\n    const loader = document.createElement(\"li\");\n    loader.className = \"library-inspector__loading\";\n    loader.textContent = \"Loading sectionsâ€¦\";\n    sectionList.appendChild(loader);\n\n    const sections = await services.loadSections(pageId);\n    sectionList.innerHTML = \"\";\n\n    if (!sections.length) {\n      const empty = document.createElement(\"li\");\n      empty.className = \"library-inspector__empty\";\n      empty.textContent = \"No sections available yet.\";\n      sectionList.appendChild(empty);\n      return;\n    }\n\n    sections.forEach((section) => {\n      const item = document.createElement(\"li\");\n      item.className = \"library-inspector__list-item\";\n\n      const header = document.createElement(\"div\");\n      header.className = \"library-inspector__list-head\";\n      const title = document.createElement(\"strong\");\n      title.textContent = section.title ?? section.sectionKey ?? \"Untitled section\";\n      const meta = document.createElement(\"span\");\n      meta.textContent = `${section.contentType} · Updated ${formatDateTimeShort(section.updatedAtUtc)}`;\n      header.append(title, meta);\n\n      const footer = document.createElement(\"div\");\n      footer.className = \"library-inspector__list-meta\";\n      footer.textContent = section.lastPublishedAtUtc\n        ? `Last publish ${formatDateTimeShort(section.lastPublishedAtUtc)}`\n        : \"Draft not yet published\";\n\n      item.append(header, footer);\n      sectionList.appendChild(item);\n    });\n  }\n\n  async function renderActivity(pageId: string) {\n    if (!activityList) return;\n    activityList.innerHTML = \"\";\n    const loader = document.createElement(\"li\");\n    loader.className = \"library-inspector__loading\";\n    loader.textContent = \"Loading activityâ€¦\";\n    activityList.appendChild(loader);\n\n    const history = await services.loadActivity(pageId);\n    activityList.innerHTML = \"\";\n\n    if (!history.length) {\n      const empty = document.createElement(\"li\");\n      empty.className = \"library-inspector__empty\";\n      empty.textContent = \"No recent edits recorded.\";\n      activityList.appendChild(empty);\n      return;\n    }\n\n    history.forEach((entry) => {\n      const item = document.createElement(\"li\");\n      item.className = \"library-inspector__list-item\";\n      const header = document.createElement(\"div\");\n      header.className = \"library-inspector__list-head\";\n      const title = document.createElement(\"strong\");\n      title.textContent = entry.changeSummary ?? entry.fieldKey ?? \"Content update\";\n      const meta = document.createElement(\"span\");\n      meta.textContent = `${entry.performedByDisplayName ?? \"Unknown\"} · ${formatDateTimeShort(entry.performedAtUtc)}`;\n      header.append(title, meta);\n\n      const footer = document.createElement(\"div\");\n      footer.className = \"library-inspector__list-meta\";\n      footer.textContent = buildHistorySnippet(entry);\n\n      item.append(header, footer);\n      activityList.appendChild(item);\n    });\n  }\n\n  return { open, hide };\n}\n\nfunction updateInspectorTabs(\n  tabs: HTMLButtonElement[],\n  panels: HTMLElement[],\n  active: string\n) {\n  tabs.forEach((tab) => {\n    const isActive = tab.getAttribute(\"data-tab\") === active;\n    tab.dataset.state = isActive ? \"active\" : \"idle\";\n  });\n\n  panels.forEach((panel) => {\n    panel.dataset.state = panel.getAttribute(\"data-panel\") === active ? \"active\" : \"idle\";\n  });\n}\n\nfunction buildSummarySignals(page: ContentPageListItem): string[] {\n  const signals: string[] = [];\n  const updated = formatDateTimeShort(page.updatedAtUtc);\n  signals.push(`Updated ${updated}`);\n\n  if (page.lastPublishedAtUtc) {\n    signals.push(`Last publish ${formatDateTimeShort(page.lastPublishedAtUtc)}`);\n    if (new Date(page.updatedAtUtc).getTime() > new Date(page.lastPublishedAtUtc).getTime()) {\n      signals.push(\"Draft changes pending publish\");\n    }\n  } else {\n    signals.push(\"Draft has not been published yet\");\n  }\n\n  const textRatio = page.sectionCount > 0 ? Math.round((page.textSections / page.sectionCount) * 100) : 0;\n  signals.push(`Copy density ${textRatio}% text · ${page.imageSections} imagery slots`);\n\n  return signals;\n}\n\nfunction buildHistorySnippet(entry: ContentHistoryEntry): string {\n  if (entry.changeSummary) {\n    return entry.changeSummary;\n  }\n\n  const previous = entry.previousValue ?? \"\";\n  const next = entry.newValue ?? \"\";\n\n  if (previous && next && previous !== next) {\n    return `Updated ${truncate(next)}`;\n  }\n  if (!previous && next) {\n    return `Added ${truncate(next)}`;\n  }\n  if (previous && !next) {\n    return `Removed ${truncate(previous)}`;\n  }\n\n  return \"No change captured.\";\n}\n\nfunction truncate(value: string, length = 60): string {\n  const trimmed = value.replace(/\\s+/g, \" \").trim();\n  return trimmed.length > length ? `${trimmed.slice(0, length)}…` : trimmed;\n}\n","import type {\n  ContentHistoryEntry,\n  DiffEnvelope,\n  ReviewStatus\n} from \"@bugence/core\";\nimport {\n  getDashboardHistory,\n  getTimelineSnapshot,\n  loadDashboardHistory,\n  useDashboardStore\n} from \"../store/dashboardStore\";\n\ntype TabKey = \"editor\" | \"details\" | \"history\";\n\ninterface SectionCardContext {\n  card: HTMLElement;\n  pageId: string;\n  sectionId: string;\n  tabs: HTMLButtonElement[];\n  panels: HTMLElement[];\n  metaHost: HTMLElement | null;\n  flagsHost: HTMLElement | null;\n  actionsHost: HTMLElement | null;\n  historyList: HTMLElement | null;\n  historyEmpty: HTMLElement | null;\n  activeTab: TabKey;\n  detailsPopulated: boolean;\n  historyLoaded: boolean;\n}\n\nconst DATE_WITH_TIME = new Intl.DateTimeFormat(undefined, {\n  month: \"short\",\n  day: \"2-digit\",\n  hour: \"2-digit\",\n  minute: \"2-digit\"\n});\n\nexport function initSectionDetails() {\n  const pageRoot = document.querySelector<HTMLElement>(\"[data-dashboard-page]\");\n  if (!pageRoot) {\n    return;\n  }\n\n  const pageId = pageRoot.getAttribute(\"data-dashboard-page\");\n  if (!pageId) {\n    return;\n  }\n\n  const cards = Array.from(document.querySelectorAll<HTMLElement>(\"[data-editor-card]\"));\n  if (!cards.length) {\n    return;\n  }\n\n  const contexts = cards\n    .map((card): SectionCardContext | null => setupCardContext(card, pageId))\n    .filter((context): context is SectionCardContext => context !== null);\n\n  if (!contexts.length) {\n    return;\n  }\n\n  const store = useDashboardStore();\n\n  const refresh = () => {\n    const snapshot = getTimelineSnapshot(pageId);\n    contexts.forEach((context) => updateContextFromTimeline(context, snapshot));\n  };\n\n  refresh();\n  const unsubscribe = store.subscribe(refresh);\n\n  window.addEventListener(\n    \"beforeunload\",\n    () => {\n      unsubscribe();\n    },\n    { once: true }\n  );\n}\n\nfunction setupCardContext(card: HTMLElement, pageId: string): SectionCardContext | null {\n  const sectionId = card.getAttribute(\"data-section-id\");\n  if (!sectionId) {\n    return null;\n  }\n\n  const tabs = Array.from(\n    card.querySelectorAll<HTMLButtonElement>(\"[data-section-tabs] [data-section-tab]\")\n  );\n  const panels = Array.from(\n    card.querySelectorAll<HTMLElement>(\"[data-section-panel]\")\n  );\n\n  const context: SectionCardContext = {\n    card,\n    pageId,\n    sectionId,\n    tabs,\n    panels,\n    metaHost: card.querySelector<HTMLElement>(\"[data-section-meta]\"),\n    flagsHost: card.querySelector<HTMLElement>(\"[data-section-flags]\"),\n    actionsHost: card.querySelector<HTMLElement>(\"[data-section-actions]\"),\n    historyList: card.querySelector<HTMLElement>(\"[data-section-history-list]\"),\n    historyEmpty: card.querySelector<HTMLElement>(\"[data-section-history-empty]\"),\n    activeTab: \"editor\",\n    detailsPopulated: false,\n    historyLoaded: false\n  };\n\n  tabs.forEach((tab) => {\n    tab.addEventListener(\"click\", () => {\n      const key = tab.getAttribute(\"data-section-tab\") as TabKey | null;\n      if (!key || context.activeTab === key) {\n        return;\n      }\n\n      context.activeTab = key;\n      updateTabVisualState(context);\n\n      if (key === \"details\" && !context.detailsPopulated) {\n        populateDetails(context);\n      }\n\n      if (key === \"history\" && !context.historyLoaded) {\n        void populateHistory(context);\n      }\n    });\n  });\n\n  return context;\n}\n\nfunction updateContextFromTimeline(\n  context: SectionCardContext,\n  snapshot: ReturnType<typeof getTimelineSnapshot>\n) {\n  if (context.activeTab === \"details\") {\n    populateDetails(context, snapshot);\n  } else {\n    context.detailsPopulated = false;\n  }\n\n  if (context.activeTab === \"history\" && context.historyLoaded) {\n    void populateHistory(context);\n  }\n}\n\nfunction updateTabVisualState(context: SectionCardContext) {\n  context.tabs.forEach((tab) => {\n    const key = tab.getAttribute(\"data-section-tab\");\n    tab.dataset.state = key === context.activeTab ? \"active\" : \"idle\";\n  });\n\n  context.panels.forEach((panel) => {\n    const key = panel.getAttribute(\"data-section-panel\");\n    panel.dataset.state = key === context.activeTab ? \"active\" : \"idle\";\n  });\n}\n\nfunction populateDetails(\n  context: SectionCardContext,\n  snapshot = getTimelineSnapshot(context.pageId)\n) {\n  const { metaHost, flagsHost, actionsHost, card, sectionId } = context;\n  if (!metaHost || !flagsHost || !actionsHost) {\n    return;\n  }\n\n  const dataset = card.dataset;\n  const timelineDirty = snapshot.dirtySections[sectionId];\n  const reviewStatus = snapshot.reviewStatuses[sectionId];\n  const isConflicted = snapshot.conflictSectionIds.includes(sectionId);\n\n  const rows: Array<[string, string]> = [\n    [\"Key\", dataset.sectionKey ?? \"\"],\n    [\"Selector\", dataset.sectionSelector ?? \"No selector\"],\n    [\"Content type\", dataset.sectionType ?? \"Unknown\"],\n    [\"Display order\", dataset.sectionOrder ?? \"—\"]\n  ];\n\n  if (dataset.sectionUpdated) {\n    rows.push([\"Last updated\", formatDate(dataset.sectionUpdated)]);\n  }\n\n  if (dataset.sectionPublished) {\n    rows.push([\"Last published\", formatDate(dataset.sectionPublished)]);\n  } else {\n    rows.push([\"Last published\", \"Not yet published\"]);\n  }\n\n  metaHost.innerHTML = \"\";\n  rows.forEach(([label, value]) => {\n    const dt = document.createElement(\"dt\");\n    dt.textContent = label;\n    const dd = document.createElement(\"dd\");\n    dd.textContent = value;\n    metaHost.append(dt, dd);\n  });\n\n  flagsHost.innerHTML = \"\";\n  const flags: string[] = [];\n  if (dataset.sectionLocked === \"true\") {\n    flags.push(\"Locked by concierge\");\n  } else {\n    flags.push(\"Editable\");\n  }\n\n  if (dataset.sectionHasDraft === \"true\") {\n    flags.push(\"Draft ahead of publish\");\n  }\n\n  if (timelineDirty?.dirty) {\n    flags.push(\"Unsaved diff detected\");\n  }\n\n  if (isConflicted) {\n    flags.push(\"Conflict with remote baseline\");\n  }\n\n  if (reviewStatus) {\n    flags.push(`Review status: ${formatReviewStatus(reviewStatus)}`);\n  }\n\n  flags.forEach((flag) => {\n    const badge = document.createElement(\"span\");\n    badge.className = \"section-card__flag\";\n    badge.textContent = flag;\n    flagsHost.appendChild(badge);\n  });\n\n  actionsHost.innerHTML = \"\";\n  if (timelineDirty?.diff) {\n    const diff = timelineDirty.diff;\n    const summary = document.createElement(\"article\");\n    summary.className = \"section-card__diff\";\n\n    const title = document.createElement(\"h4\");\n    title.textContent = `Diff · ${capitalize(diff.changeType)}`;\n\n    const body = document.createElement(\"p\");\n    body.textContent = buildDiffSummary(diff);\n\n    summary.append(title, body);\n    actionsHost.appendChild(summary);\n  } else {\n    const message = document.createElement(\"p\");\n    message.className = \"section-card__diff-empty\";\n    message.textContent = \"No active diff recorded for this section.\";\n    actionsHost.appendChild(message);\n  }\n\n  context.detailsPopulated = true;\n}\n\nasync function populateHistory(context: SectionCardContext) {\n  const { pageId, sectionId, historyList, historyEmpty } = context;\n  if (!historyList) {\n    return;\n  }\n\n  if (historyEmpty) {\n    historyEmpty.hidden = true;\n  }\n  historyList.innerHTML = \"\";\n\n  try {\n    await loadDashboardHistory({ pageId, take: 60, force: !context.historyLoaded, ttlMs: 0 });\n  } catch {\n    // swallow fetch errors; store may already have data\n  }\n\n  const entries = getDashboardHistory(pageId, 60).filter(\n    (entry) => entry.pageSectionId === sectionId\n  );\n\n  if (!entries.length) {\n    if (historyEmpty) {\n      historyEmpty.hidden = false;\n    }\n    context.historyLoaded = true;\n    return;\n  }\n\n  const fragment = document.createDocumentFragment();\n  entries.slice(0, 6).forEach((entry) => {\n    const item = document.createElement(\"li\");\n    item.className = \"section-card__history-item\";\n\n    const header = document.createElement(\"div\");\n    header.className = \"section-card__history-head\";\n    const title = document.createElement(\"strong\");\n    title.textContent = entry.changeSummary ?? entry.fieldKey ?? \"Content update\";\n    const meta = document.createElement(\"span\");\n    meta.textContent = `${entry.performedByDisplayName ?? \"Unknown\"} · ${formatDate(entry.performedAtUtc)}`;\n    header.append(title, meta);\n\n    const details = document.createElement(\"div\");\n    details.className = \"section-card__history-body\";\n    details.textContent = buildHistorySummary(entry);\n\n    item.append(header, details);\n    fragment.appendChild(item);\n  });\n\n  historyList.appendChild(fragment);\n  context.historyLoaded = true;\n}\n\nfunction buildDiffSummary(diff: DiffEnvelope): string {\n  const sectionKey =\n    diff.after?.payload.sectionKey ??\n    diff.before?.payload.sectionKey ??\n    diff.sectionId;\n  const summaryParts = [`${capitalize(diff.changeType)} · ${sectionKey}`];\n  if (diff.annotations?.length) {\n    summaryParts.push(diff.annotations.join(\"; \"));\n  }\n  return summaryParts.join(\" — \");\n}\n\nfunction buildHistorySummary(entry: ContentHistoryEntry): string {\n  if (entry.changeSummary) {\n    return entry.changeSummary;\n  }\n\n  const previous = entry.previousValue ?? \"\";\n  const current = entry.newValue ?? \"\";\n\n  if (previous && current && previous !== current) {\n    return `Modified content to \"${truncate(current)}\"`;\n  }\n\n  if (!previous && current) {\n    return `Added \"${truncate(current)}\"`;\n  }\n\n  if (previous && !current) {\n    return `Removed \"${truncate(previous)}\"`;\n  }\n\n  return \"No content changes recorded.\";\n}\n\nfunction formatDate(value: string): string {\n  const date = new Date(value);\n  return Number.isNaN(date.getTime()) ? value : DATE_WITH_TIME.format(date);\n}\n\nfunction formatReviewStatus(status: ReviewStatus): string {\n  switch (status) {\n    case \"approved\":\n      return \"Approved\";\n    case \"rejected\":\n      return \"Needs revision\";\n    case \"pending\":\n    default:\n      return \"Pending review\";\n  }\n}\n\nfunction capitalize(value: string): string {\n  return value.charAt(0).toUpperCase() + value.slice(1);\n}\n\nfunction truncate(value: string, length = 60): string {\n  const next = value.replace(/\\s+/g, \" \").trim();\n  return next.length > length ? `${next.slice(0, length)}…` : next;\n}\n","import type { PublishSummary } from \"@bugence/core\";\nimport { getTimelineSnapshot, useDashboardStore } from \"../store/dashboardStore\";\n\ninterface PublishTask {\n  id: string;\n  label: string;\n  completed: boolean;\n  origin: \"default\" | \"event\" | \"manual\";\n}\n\ninterface PublishConsoleState {\n  tasks: PublishTask[];\n  summary: PublishSummary | null;\n  notes: string;\n}\n\nconst DEFAULT_TASKS: PublishTask[] = [\n  { id: \"copy-review\", label: \"Confirm copy review completed\", completed: false, origin: \"default\" },\n  { id: \"accessibility-audit\", label: \"Run accessibility spot-check\", completed: false, origin: \"default\" }\n];\n\nexport function initPublishConsole() {\n  const summaryPanel = document.querySelector<HTMLElement>(\"[data-publish-summary-panel]\");\n  const consoleRoot = document.querySelector<HTMLElement>(\"[data-publish-console]\");\n  const notificationsHost = document.querySelector<HTMLElement>(\"[data-dashboard-notifications]\");\n  const publishForm = document.querySelector<HTMLFormElement>(\"[data-publish-form]\");\n  const pageId = document.querySelector<HTMLElement>(\"[data-dashboard-page]\")?.getAttribute(\"data-dashboard-page\");\n\n  if (!summaryPanel || !consoleRoot || !pageId || !publishForm) {\n    return;\n  }\n\n  const openButton = summaryPanel.querySelector<HTMLButtonElement>(\"[data-publish-console-open]\");\n  const previewList = summaryPanel.querySelector<HTMLElement>(\"[data-publish-task-preview]\");\n  const previewEmpty = summaryPanel.querySelector<HTMLElement>(\"[data-publish-task-empty]\");\n\n  const summaryList = consoleRoot.querySelector<HTMLElement>(\"[data-publish-console-summary]\");\n  const summaryEmpty = consoleRoot.querySelector<HTMLElement>(\"[data-publish-console-summary-empty]\");\n  const summaryCount = consoleRoot.querySelector<HTMLElement>(\"[data-publish-console-summary-count]\");\n\n  const taskList = consoleRoot.querySelector<HTMLElement>(\"[data-publish-console-task-list]\");\n  const taskEmpty = consoleRoot.querySelector<HTMLElement>(\"[data-publish-console-task-empty]\");\n  const taskProgress = consoleRoot.querySelector<HTMLElement>(\"[data-publish-console-task-progress]\");\n  const taskForm = consoleRoot.querySelector<HTMLFormElement>(\"[data-publish-console-task-form]\");\n\n  const notesInput = consoleRoot.querySelector<HTMLTextAreaElement>(\"[data-publish-console-notes]\");\n  const statusHost = consoleRoot.querySelector<HTMLElement>(\"[data-publish-console-status]\");\n  const confirmButton = consoleRoot.querySelector<HTMLButtonElement>(\"[data-publish-console-confirm]\");\n  const closeButtons = consoleRoot.querySelectorAll<HTMLElement>(\"[data-publish-console-close]\");\n\n  const state: PublishConsoleState = {\n    tasks: DEFAULT_TASKS.map((task) => ({ ...task })),\n    summary: null,\n    notes: \"\"\n  };\n\n  const store = useDashboardStore();\n\n  const render = () => {\n    const snapshot = getTimelineSnapshot(pageId);\n    state.summary = snapshot.publishSummary ?? null;\n    updateSummary(state, summaryList, summaryEmpty, summaryCount);\n    updateTaskViews(state, { previewList, previewEmpty, taskList, taskEmpty, taskProgress });\n    updateStatus(state, statusHost, confirmButton);\n  };\n\n  render();\n  const unsubscribe = store.subscribe(render);\n\n  openButton?.addEventListener(\"click\", () => openConsole(consoleRoot));\n  closeButtons.forEach((button) =>\n    button.addEventListener(\"click\", () => closeConsole(consoleRoot))\n  );\n  consoleRoot.addEventListener(\"keydown\", (event) => {\n    if (event.key === \"Escape\") {\n      closeConsole(consoleRoot);\n    }\n  });\n\n  confirmButton?.addEventListener(\"click\", () => {\n    if (confirmButton.disabled) {\n      return;\n    }\n    publishForm.requestSubmit();\n    closeConsole(consoleRoot);\n    if (notificationsHost) {\n      pushNotification(\n        notificationsHost,\n        \"Publishing request dispatched\",\n        \"Concierge automation is processing your publish request.\"\n      );\n    }\n  });\n\n  taskList?.addEventListener(\"change\", (event) => {\n    const target = event.target as HTMLInputElement | null;\n    if (!target || target.type !== \"checkbox\") {\n      return;\n    }\n\n    const taskId = target.getAttribute(\"data-task-id\");\n    if (!taskId) {\n      return;\n    }\n\n    const task = state.tasks.find((item) => item.id === taskId);\n    if (!task) {\n      return;\n    }\n\n    task.completed = target.checked;\n    updateTaskViews(state, { previewList, previewEmpty, taskList, taskEmpty, taskProgress });\n    updateStatus(state, statusHost, confirmButton);\n  });\n\n  taskList?.addEventListener(\"click\", (event) => {\n    const button = (event.target as HTMLElement | null)?.closest<HTMLButtonElement>(\"[data-task-remove]\");\n    if (!button) {\n      return;\n    }\n\n    const taskId = button.getAttribute(\"data-task-remove\");\n    if (!taskId) {\n      return;\n    }\n\n    const index = state.tasks.findIndex((task) => task.id === taskId);\n    if (index >= 0 && state.tasks[index].origin === \"manual\") {\n      state.tasks.splice(index, 1);\n      updateTaskViews(state, { previewList, previewEmpty, taskList, taskEmpty, taskProgress });\n      updateStatus(state, statusHost, confirmButton);\n    }\n  });\n\n  taskForm?.addEventListener(\"submit\", (event) => {\n    event.preventDefault();\n    const input = taskForm.querySelector<HTMLInputElement>(\"input[type='text']\");\n    if (!input) {\n      return;\n    }\n\n    const label = input.value.trim();\n    if (!label) {\n      return;\n    }\n\n    const id = `manual-${Date.now()}`;\n    state.tasks.push({ id, label, completed: false, origin: \"manual\" });\n    input.value = \"\";\n    updateTaskViews(state, { previewList, previewEmpty, taskList, taskEmpty, taskProgress });\n    updateStatus(state, statusHost, confirmButton);\n  });\n\n  notesInput?.addEventListener(\"input\", () => {\n    state.notes = notesInput.value;\n  });\n\n  document.addEventListener(\"dashboard:task:add\", (event) => {\n    const detail = (event as CustomEvent<{ id: string; label: string }>).detail;\n    if (!detail) {\n      return;\n    }\n\n    if (state.tasks.some((task) => task.id === detail.id)) {\n      return;\n    }\n\n    state.tasks.push({\n      id: detail.id,\n      label: detail.label,\n      completed: false,\n      origin: \"event\"\n    });\n\n    updateTaskViews(state, { previewList, previewEmpty, taskList, taskEmpty, taskProgress });\n    updateStatus(state, statusHost, confirmButton);\n    if (notificationsHost) {\n      pushNotification(\n        notificationsHost,\n        \"Task added\",\n        detail.label\n      );\n    }\n  });\n\n  window.addEventListener(\n    \"beforeunload\",\n    () => {\n      unsubscribe();\n    },\n    { once: true }\n  );\n}\n\nfunction openConsole(root: HTMLElement) {\n  root.hidden = false;\n  requestAnimationFrame(() => {\n    root.dataset.state = \"open\";\n    const closeButton = root.querySelector<HTMLButtonElement>(\".publish-console__close\");\n    closeButton?.focus({ preventScroll: true });\n    document.body.style.setProperty(\"overflow\", \"hidden\");\n  });\n}\n\nfunction closeConsole(root: HTMLElement) {\n  root.dataset.state = \"idle\";\n  document.body.style.removeProperty(\"overflow\");\n  setTimeout(() => {\n    root.hidden = true;\n  }, 180);\n}\n\nfunction updateSummary(\n  state: PublishConsoleState,\n  list: HTMLElement | null,\n  emptyState: HTMLElement | null,\n  summaryCount: HTMLElement | null\n) {\n  if (!list) {\n    return;\n  }\n\n  list.innerHTML = \"\";\n\n  const summary = state.summary;\n  if (!summary || summary.entries.length === 0) {\n    if (emptyState) {\n      emptyState.hidden = false;\n    }\n    if (summaryCount) {\n      summaryCount.textContent = \"0 sections\";\n    }\n    return;\n  }\n\n  if (emptyState) {\n    emptyState.hidden = true;\n  }\n\n  if (summaryCount) {\n    summaryCount.textContent = `${summary.entries.length} section${summary.entries.length === 1 ? \"\" : \"s\"}`;\n  }\n\n  const fragment = document.createDocumentFragment();\n  summary.entries.forEach((entry) => {\n    const item = document.createElement(\"li\");\n    item.className = \"publish-console__summary-item\";\n    item.dataset.changeType = entry.changeType;\n\n    const title = document.createElement(\"div\");\n    title.className = \"publish-console__summary-head\";\n    const key = document.createElement(\"strong\");\n    key.textContent = entry.sectionKey ?? \"Section\";\n    const meta = document.createElement(\"span\");\n    meta.textContent = `${entry.changeType} · ${entry.contentType ?? \"Content\"}`;\n    title.append(key, meta);\n\n    const notes = document.createElement(\"p\");\n    notes.className = \"publish-console__summary-notes\";\n    notes.textContent = entry.diffSummary ?? \"No diff summary recorded.\";\n\n    item.append(title, notes);\n    fragment.appendChild(item);\n  });\n\n  list.appendChild(fragment);\n}\n\nfunction updateTaskViews(\n  state: PublishConsoleState,\n  elements: {\n    previewList: HTMLElement | null;\n    previewEmpty: HTMLElement | null;\n    taskList: HTMLElement | null;\n    taskEmpty: HTMLElement | null;\n    taskProgress: HTMLElement | null;\n  }\n) {\n  const { tasks } = state;\n  const completed = tasks.filter((task) => task.completed).length;\n\n  if (elements.previewList) {\n    elements.previewList.innerHTML = \"\";\n    const limited = tasks.slice(0, 3);\n    if (!limited.length) {\n      if (elements.previewEmpty) elements.previewEmpty.hidden = false;\n    } else {\n      if (elements.previewEmpty) elements.previewEmpty.hidden = true;\n      limited.forEach((task) => {\n        const item = document.createElement(\"li\");\n        item.className = \"publish-console__preview-item\";\n        item.dataset.state = task.completed ? \"done\" : \"pending\";\n        item.textContent = task.label;\n        elements.previewList?.appendChild(item);\n      });\n    }\n  }\n\n  if (elements.taskList) {\n    elements.taskList.innerHTML = \"\";\n    if (!tasks.length) {\n      if (elements.taskEmpty) elements.taskEmpty.hidden = false;\n    } else {\n      if (elements.taskEmpty) elements.taskEmpty.hidden = true;\n      const fragment = document.createDocumentFragment();\n      tasks.forEach((task) => {\n        const item = document.createElement(\"li\");\n        item.className = \"publish-console__task\";\n\n        const label = document.createElement(\"label\");\n        label.className = \"publish-console__task-label\";\n\n        const checkbox = document.createElement(\"input\");\n        checkbox.type = \"checkbox\";\n        checkbox.checked = task.completed;\n        checkbox.setAttribute(\"data-task-id\", task.id);\n\n        const text = document.createElement(\"span\");\n        text.textContent = task.label;\n\n        label.append(checkbox, text);\n        item.appendChild(label);\n\n        if (task.origin === \"manual\") {\n          const remove = document.createElement(\"button\");\n          remove.type = \"button\";\n          remove.className = \"publish-console__task-remove\";\n          remove.setAttribute(\"data-task-remove\", task.id);\n          remove.innerHTML = `<span class=\"fa-solid fa-xmark\" aria-hidden=\"true\"></span><span class=\"sr-only\">Remove task</span>`;\n          item.appendChild(remove);\n        }\n\n        fragment.appendChild(item);\n      });\n      elements.taskList.appendChild(fragment);\n    }\n  }\n\n  if (elements.taskProgress) {\n    elements.taskProgress.textContent = `${completed} of ${tasks.length} complete`;\n  }\n}\n\nfunction updateStatus(\n  state: PublishConsoleState,\n  statusHost: HTMLElement | null,\n  confirmButton: HTMLButtonElement | null\n) {\n  const hasOutstandingTasks = state.tasks.some((task) => !task.completed);\n  const hasSummary = Boolean(state.summary && state.summary.entries.length);\n\n  if (statusHost) {\n    if (!hasSummary) {\n      statusHost.textContent = \"Generate a diff summary before publishing.\";\n    } else if (hasOutstandingTasks) {\n      statusHost.textContent = \"Complete all pre-flight tasks to enable publishing.\";\n    } else {\n      statusHost.textContent = \"All tasks completed. Ready for publish.\";\n    }\n  }\n\n  if (confirmButton) {\n    confirmButton.disabled = hasOutstandingTasks || !hasSummary;\n  }\n}\n\nfunction pushNotification(host: HTMLElement, title: string, message: string) {\n  const item = document.createElement(\"div\");\n  item.className = \"dashboard-notification\";\n  const heading = document.createElement(\"strong\");\n  heading.textContent = title;\n  const body = document.createElement(\"p\");\n  body.textContent = message;\n  item.append(heading, body);\n  host.appendChild(item);\n  setTimeout(() => {\n    item.classList.add(\"dashboard-notification--hide\");\n    setTimeout(() => {\n      item.remove();\n    }, 300);\n  }, 4000);\n}\n","import type { DashboardTimelineSnapshot } from \"../store/dashboardStore\";\nimport { getTimelineSnapshot, useDashboardStore } from \"../store/dashboardStore\";\n\nexport function initDashboardNotifications() {\n  const host = document.querySelector<HTMLElement>(\"[data-dashboard-notifications]\");\n  const pageId = document.querySelector<HTMLElement>(\"[data-dashboard-page]\")?.getAttribute(\"data-dashboard-page\");\n\n  if (!host || !pageId) {\n    return;\n  }\n\n  const store = useDashboardStore();\n  const seen = new Set<string>();\n\n  const handleSnapshot = (snapshot: DashboardTimelineSnapshot) => {\n    snapshot.events.forEach((event) => {\n      if (seen.has(event.id)) {\n        return;\n      }\n      seen.add(event.id);\n\n      switch (event.type) {\n        case \"draft-conflict\":\n          pushNotification(host, \"Conflict detected\", event.description ?? \"Resolve conflicts before publishing.\");\n          dispatchTask(`conflict-${event.sectionId}`, `Resolve conflict for ${event.sectionKey ?? \"a section\"}`);\n          break;\n        case \"review-status\":\n          if (event.reviewStatus === \"pending\") {\n            pushNotification(host, \"Review requested\", `${event.sectionKey ?? \"Section\"} needs review.`);\n            dispatchTask(`review-${event.sectionId}`, `Complete review for ${event.sectionKey ?? \"section\"}`);\n          }\n          if (event.reviewStatus === \"rejected\") {\n            pushNotification(host, \"Review rejected\", event.description ?? \"Update content before publishing.\");\n            dispatchTask(`rework-${event.sectionId}`, `Address review feedback for ${event.sectionKey ?? \"section\"}`);\n          }\n          break;\n        case \"draft-dirty\":\n          pushNotification(host, \"Draft updated\", event.description ?? \"New draft changes ready for review.\");\n          break;\n        case \"publish-summary\":\n          pushNotification(host, \"Publish ready\", \"Diff summary prepared in publish console.\");\n          break;\n        default:\n          break;\n      }\n    });\n  };\n\n  const render = () => {\n    const snapshot = getTimelineSnapshot(pageId);\n    handleSnapshot(snapshot);\n  };\n\n  render();\n  const unsubscribe = store.subscribe(render);\n\n  window.addEventListener(\n    \"beforeunload\",\n    () => {\n      unsubscribe();\n    },\n    { once: true }\n  );\n}\n\nfunction pushNotification(host: HTMLElement, title: string, message: string) {\n  const item = document.createElement(\"div\");\n  item.className = \"dashboard-notification\";\n  const heading = document.createElement(\"strong\");\n  heading.textContent = title;\n  const body = document.createElement(\"p\");\n  body.textContent = message;\n  item.append(heading, body);\n  host.appendChild(item);\n  requestAnimationFrame(() => {\n    item.dataset.state = \"visible\";\n  });\n  setTimeout(() => {\n    item.dataset.state = \"closing\";\n    setTimeout(() => {\n      item.remove();\n    }, 300);\n  }, 4500);\n}\n\nfunction dispatchTask(id: string, label: string) {\n  document.dispatchEvent(new CustomEvent(\"dashboard:task:add\", { detail: { id, label } }));\n}\n","// @ts-nocheck\nimport { initInsightsAnalytics } from \"@bugence/analytics\";\nimport { initSchemaSidebar } from \"./ui/schemaSidebar\";\nimport { initTimelinePanel } from \"./ui/timelinePanel\";\nimport { initLibraryConsole } from \"./ui/libraryConsole\";\nimport { initSectionDetails } from \"./ui/sectionDetails\";\nimport { initPublishConsole } from \"./ui/publishConsole\";\nimport { initDashboardNotifications } from \"./ui/dashboardNotifications\";\n\n(() => {\n    const initProfileMenus = () => {\n        const menus = Array.from(document.querySelectorAll('[data-profile-menu]'));\n        if (!menus.length) {\n            return;\n        }\n\n        const toggleSelector = '[data-profile-toggle]';\n        let activeMenu = null;\n\n        const findMenu = (element) => element ? menus.find((menu) => menu.contains(element)) || null : null;\n\n        const setMenuState = (menu, isOpen) => {\n            const trigger = menu.querySelector(toggleSelector);\n            if (trigger) {\n                trigger.setAttribute('aria-expanded', isOpen ? 'true' : 'false');\n            }\n\n            menu.dataset.open = isOpen ? 'true' : 'false';\n        };\n\n        const closeMenu = (menu) => {\n            if (!menu) {\n                return;\n            }\n\n            setMenuState(menu, false);\n            if (activeMenu === menu) {\n                activeMenu = null;\n            }\n        };\n\n        const openMenu = (menu) => {\n            if (activeMenu && activeMenu !== menu) {\n                closeMenu(activeMenu);\n            }\n\n            setMenuState(menu, true);\n            activeMenu = menu;\n        };\n\n        const focusFirstAction = (menu) => {\n            const firstAction = menu.querySelector('[role=\"menuitem\"]');\n            if (firstAction) {\n                firstAction.focus({ preventScroll: true });\n            }\n        };\n\n        const isToggle = (element) => !!element?.closest(toggleSelector);\n\n        document.addEventListener('click', (event) => {\n            const toggle = event.target.closest(toggleSelector);\n\n            if (toggle) {\n                const menu = findMenu(toggle);\n                if (!menu) {\n                    return;\n                }\n\n                event.preventDefault();\n                const isOpen = menu.dataset.open === 'true';\n                if (isOpen) {\n                    closeMenu(menu);\n                } else {\n                    openMenu(menu);\n                }\n\n                return;\n            }\n\n            if (activeMenu && !activeMenu.contains(event.target)) {\n                closeMenu(activeMenu);\n            }\n        });\n\n        document.addEventListener('keydown', (event) => {\n            const target = event.target;\n\n            if (target instanceof HTMLElement) {\n                if (target.isContentEditable || target.matches('input, textarea, select')) {\n                    return;\n                }\n            }\n\n            if (isToggle(target)) {\n                const menu = findMenu(target);\n                if (!menu) {\n                    return;\n                }\n\n                if (event.key === 'Enter' || event.key === ' ') {\n                    event.preventDefault();\n                    target.click();\n                }\n\n                if (event.key === 'ArrowDown') {\n                    event.preventDefault();\n                    if (menu.dataset.open !== 'true') {\n                        openMenu(menu);\n                    }\n\n                    focusFirstAction(menu);\n                }\n\n                if (event.key === 'Escape') {\n                    event.preventDefault();\n                    closeMenu(menu);\n                }\n\n                return;\n            }\n\n            if (event.key === 'Escape' && activeMenu) {\n                const trigger = activeMenu.querySelector(toggleSelector);\n                closeMenu(activeMenu);\n                if (trigger) {\n                    trigger.focus({ preventScroll: true });\n                }\n            }\n        });\n\n        document.addEventListener('focusin', (event) => {\n            if (activeMenu && !activeMenu.contains(event.target)) {\n                closeMenu(activeMenu);\n            }\n        });\n\n        window.addEventListener('blur', () => {\n            if (activeMenu) {\n                closeMenu(activeMenu);\n            }\n        });\n    };\n\n    const initNavDropdowns = () => {\n        const dropdowns = Array.from(document.querySelectorAll('[data-nav-dropdown]'));\n        if (!dropdowns.length) {\n            return;\n        }\n\n        const closeAll = (exception = null) => {\n            dropdowns.forEach((dropdown) => {\n                const toggle = dropdown.querySelector('[data-nav-dropdown-toggle]');\n                const shouldRemainOpen = dropdown === exception;\n                dropdown.dataset.open = shouldRemainOpen ? 'true' : 'false';\n                if (toggle) {\n                    toggle.setAttribute('aria-expanded', shouldRemainOpen ? 'true' : 'false');\n                }\n            });\n        };\n\n        dropdowns.forEach((dropdown) => {\n            const toggle = dropdown.querySelector('[data-nav-dropdown-toggle]');\n            if (!toggle) {\n                return;\n            }\n\n            const menu = dropdown.querySelector('[data-nav-dropdown-menu]');\n            const setState = (isOpen) => {\n                dropdown.dataset.open = isOpen ? 'true' : 'false';\n                toggle.setAttribute('aria-expanded', isOpen ? 'true' : 'false');\n            };\n\n            toggle.addEventListener('click', (event) => {\n                event.preventDefault();\n                const isOpen = dropdown.dataset.open === 'true';\n                if (isOpen) {\n                    setState(false);\n                } else {\n                    closeAll(dropdown);\n                    setState(true);\n                }\n            });\n\n            dropdown.addEventListener('keydown', (event) => {\n                if (event.key === 'Escape') {\n                    setState(false);\n                    toggle.focus({ preventScroll: true });\n                }\n            });\n\n            if (menu) {\n                menu.querySelectorAll('a, button').forEach((item) => {\n                    item.addEventListener('click', () => {\n                        setState(false);\n                    });\n                });\n            }\n        });\n\n        document.addEventListener('click', (event) => {\n            if (dropdowns.some((dropdown) => dropdown.contains(event.target))) {\n                return;\n            }\n\n            closeAll();\n        });\n\n        closeAll();\n    };\n\n    const initRichEditors = () => {\n        const editors = Array.from(document.querySelectorAll('[data-editor]'));\n        if (!editors.length) {\n            return;\n        }\n\n        const ALLOWED_STYLE_PROPERTIES = new Set([\n            'color',\n            'background-color',\n            'font-size',\n            'font-family',\n            'font-style',\n            'font-weight',\n            'font-variant',\n            'text-transform',\n            'text-decoration',\n            'text-decoration-line',\n            'letter-spacing',\n            'line-height'\n        ]);\n\n        const sanitizeStyleAttribute = (value) => {\n            if (!value) {\n                return '';\n            }\n\n            const sanitized = value\n                .split(';')\n                .map((segment) => segment.trim())\n                .filter(Boolean)\n                .map((segment) => {\n                    const [rawProperty, ...rawValueParts] = segment.split(':');\n                    if (!rawProperty || rawValueParts.length === 0) {\n                        return null;\n                    }\n\n                    const property = rawProperty.trim().toLowerCase();\n                    if (!ALLOWED_STYLE_PROPERTIES.has(property)) {\n                        return null;\n                    }\n\n                    const rawValue = rawValueParts.join(':').trim();\n                    if (\n                        !rawValue ||\n                        /url\\s*\\(/i.test(rawValue) ||\n                        /expression/i.test(rawValue) ||\n                        /javascript:/i.test(rawValue)\n                    ) {\n                        return null;\n                    }\n\n                    return `${property}: ${rawValue}`;\n                })\n                .filter(Boolean)\n                .join('; ');\n\n            return sanitized;\n        };\n\n        const sanitizeHtml = (input) => {\n            const template = document.createElement('template');\n            template.innerHTML = input;\n\n            template.content.querySelectorAll('script, style').forEach((node) => node.remove());\n            template.content.querySelectorAll('*').forEach((node) => {\n                Array.from(node.attributes).forEach((attr) => {\n                    if (attr.name.startsWith('on')) {\n                        node.removeAttribute(attr.name);\n                        return;\n                    }\n\n                    if (attr.name === 'style') {\n                        const cleaned = sanitizeStyleAttribute(attr.value);\n                        if (cleaned) {\n                            node.setAttribute('style', cleaned);\n                        } else {\n                            node.removeAttribute('style');\n                        }\n                    }\n                });\n            });\n\n            return template.innerHTML;\n        };\n\n        const escapeHtml = (value) => {\n            if (typeof value !== 'string') {\n                return '';\n            }\n\n            return value\n                .replace(/&/g, '&amp;')\n                .replace(/</g, '&lt;')\n                .replace(/>/g, '&gt;')\n                .replace(/\"/g, '&quot;')\n                .replace(/'/g, '&#39;');\n        };\n\n        const editorInstances = [];\n        const processedForms = new WeakSet();\n\n        const setupEditor = (editor) => {\n            const mode = editor.dataset.editorMode || 'text';\n            const surface = editor.querySelector('[data-editor-surface]');\n            const storage = editor.querySelector('[data-editor-input]');\n            const codeArea = editor.querySelector('[data-editor-code]');\n            const metricsRoot = editor.querySelector('[data-editor-metrics]');\n            const wordsMetric = metricsRoot ? metricsRoot.querySelector('[data-editor-words]') : null;\n            const charsMetric = metricsRoot ? metricsRoot.querySelector('[data-editor-chars]') : null;\n            const readMetric = metricsRoot ? metricsRoot.querySelector('[data-editor-read]') : null;\n            const fontFamilySelect = surface ? editor.querySelector('[data-editor-font-family]') : null;\n            const fontSizeSelect = surface ? editor.querySelector('[data-editor-font-size]') : null;\n            const styleButtons = surface\n                ? Array.from(editor.querySelectorAll('[data-style-lineheight], [data-style-letterspacing], [data-style-wordspacing], [data-style-texttransform]'))\n                : [];\n\n            const fontStacks = {\n                norwester: '\"Norwester\", sans-serif',\n                inter: '\"Inter\", \"Segoe UI\", sans-serif',\n                playfair: '\"Playfair Display\", \"Times New Roman\", serif',\n                space: '\"Space Grotesk\", \"Futura\", sans-serif',\n                lora: '\"Lora\", \"Georgia\", serif',\n                work: '\"Work Sans\", \"Helvetica Neue\", sans-serif',\n                mono: '\"IBM Plex Mono\", \"SFMono-Regular\", monospace'\n            };\n\n            const buildSummarySnippet = (value) => {\n                const normalized = (value || '')\n                    .replace(/\\s+/g, ' ')\n                    .trim();\n\n                if (!normalized) {\n                    return '';\n                }\n\n                if (normalized.length <= 80) {\n                    return normalized;\n                }\n\n                return `${normalized.slice(0, 77).trimEnd()}...`;\n            };\n\n            const ensureCustomOption = (select, value) => {\n                if (!select) {\n                    return;\n                }\n\n                let existing = select.querySelector('option[data-custom=\"true\"]');\n                if (!value) {\n                    if (existing) {\n                        existing.remove();\n                    }\n                    if (select.value === '__custom__') {\n                        select.value = '';\n                    }\n                    return;\n                }\n\n                if (!existing) {\n                    existing = document.createElement('option');\n                    existing.dataset.custom = 'true';\n                    select.appendChild(existing);\n                }\n\n                existing.value = value;\n                existing.textContent = `Custom (${value})`;\n                select.value = value;\n            };\n\n            const selectionWithinSurface = () => {\n                if (!surface) {\n                    return null;\n                }\n\n                const selection = window.getSelection();\n                if (!selection || selection.rangeCount === 0) {\n                    return null;\n                }\n\n                const range = selection.getRangeAt(0);\n                if (!surface.contains(range.commonAncestorContainer)) {\n                    return null;\n                }\n\n                const anchor = selection.focusNode || selection.anchorNode;\n                let contextElement = anchor instanceof Element ? anchor : anchor?.parentElement || surface;\n                if (!surface.contains(contextElement)) {\n                    contextElement = surface;\n                }\n\n                return { selection, range, contextElement };\n            };\n\n            const wrapSelectionWithStyles = (styles) => {\n                const context = selectionWithinSurface();\n                if (!context) {\n                    return;\n                }\n\n                const { selection, range } = context;\n                const span = document.createElement('span');\n                Object.entries(styles).forEach(([key, value]) => {\n                    if (value !== undefined && value !== null) {\n                        span.style[key] = value;\n                    }\n                });\n\n                try {\n                    if (range.collapsed) {\n                        span.appendChild(document.createTextNode(''));\n                        range.insertNode(span);\n                    } else {\n                        const fragment = range.extractContents();\n                        span.appendChild(fragment);\n                        range.insertNode(span);\n                    }\n                } catch {\n                    const container = document.createElement('div');\n                    container.appendChild(range.cloneContents());\n                    span.innerHTML = container.innerHTML || selection.toString() || '';\n                    document.execCommand('insertHTML', false, span.outerHTML);\n                    return;\n                }\n\n                selection.removeAllRanges();\n                const newRange = document.createRange();\n                newRange.selectNodeContents(span);\n                if (range.collapsed) {\n                    newRange.collapse(true);\n                }\n                selection.addRange(newRange);\n            };\n\n            const markActiveStyleButton = (button) => {\n                if (!button) {\n                    return;\n                }\n\n                const controls = button.closest('.rich-editor__toolbar-controls');\n                if (controls) {\n                    controls.querySelectorAll('[aria-pressed]').forEach((candidate) => {\n                        candidate.setAttribute('aria-pressed', candidate === button ? 'true' : 'false');\n                    });\n                } else {\n                    button.setAttribute('aria-pressed', 'true');\n                }\n            };\n\n            const isDefaultStyleButton = (button) => {\n                const data = button.dataset || {};\n                const hasLine = Object.prototype.hasOwnProperty.call(data, 'styleLineheight');\n                const hasLetter = Object.prototype.hasOwnProperty.call(data, 'styleLetterspacing');\n                const hasWord = Object.prototype.hasOwnProperty.call(data, 'styleWordspacing');\n                const hasTransform = Object.prototype.hasOwnProperty.call(data, 'styleTexttransform');\n\n                return (\n                    (!hasLine || !data.styleLineheight) &&\n                    (!hasLetter || !data.styleLetterspacing) &&\n                    (!hasWord || !data.styleWordspacing) &&\n                    (!hasTransform || data.styleTexttransform === 'none')\n                );\n            };\n\n            const applyStyleButton = (button) => {\n                if (!surface) {\n                    return;\n                }\n\n                surface.focus({ preventScroll: true });\n\n                const styles = {};\n                if (Object.prototype.hasOwnProperty.call(button.dataset, 'styleLineheight')) {\n                    styles.lineHeight = button.dataset.styleLineheight || 'normal';\n                }\n                if (Object.prototype.hasOwnProperty.call(button.dataset, 'styleLetterspacing')) {\n                    styles.letterSpacing = button.dataset.styleLetterspacing || 'normal';\n                }\n                if (Object.prototype.hasOwnProperty.call(button.dataset, 'styleWordspacing')) {\n                    styles.wordSpacing = button.dataset.styleWordspacing || 'normal';\n                }\n                if (Object.prototype.hasOwnProperty.call(button.dataset, 'styleTexttransform')) {\n                    styles.textTransform = button.dataset.styleTexttransform || 'none';\n                }\n\n                wrapSelectionWithStyles(styles);\n                updateStorage();\n                markActiveStyleButton(button);\n                syncTypographyControls();\n            };\n\n            if (styleButtons.length) {\n                styleButtons.forEach((button) => {\n                    const defaultState = isDefaultStyleButton(button);\n                    button.setAttribute('aria-pressed', defaultState ? 'true' : 'false');\n                    button.addEventListener('click', () => {\n                        applyStyleButton(button);\n                    });\n                });\n            }\n\n            const resolveFontKey = (fontFamily) => {\n                if (!fontFamily) {\n                    return '';\n                }\n\n                const primary = fontFamily.replace(/[\"']/g, '').split(',')[0].trim().toLowerCase();\n\n                if (primary === 'norwester') {\n                    return 'norwester';\n                }\n\n                if (primary === 'inter' || primary === 'segoe ui' || primary === 'helvetica neue') {\n                    return 'inter';\n                }\n\n                if (primary === 'playfair display' || primary === 'times new roman') {\n                    return 'playfair';\n                }\n\n                if (primary === 'space grotesk' || primary === 'futura') {\n                    return 'space';\n                }\n\n                if (primary === 'lora' || primary === 'georgia') {\n                    return 'lora';\n                }\n\n                if (primary === 'work sans' || primary === 'helvetica') {\n                    return 'work';\n                }\n\n                if (primary === 'ibm plex mono' || primary === 'sfmono-regular' || primary === 'courier new' || primary === 'monaco') {\n                    return 'mono';\n                }\n\n                return '';\n            };\n\n            const syncTypographyControls = () => {\n                if (!surface) {\n                    return;\n                }\n\n                const context = selectionWithinSurface();\n                if (!context) {\n                    if (fontFamilySelect) {\n                        fontFamilySelect.value = '';\n                    }\n                    if (fontSizeSelect) {\n                        fontSizeSelect.value = '';\n                        ensureCustomOption(fontSizeSelect, '');\n                    }\n                    return;\n                }\n\n                const computed = window.getComputedStyle(context.contextElement);\n\n                if (fontFamilySelect) {\n                    fontFamilySelect.value = resolveFontKey(computed.fontFamily);\n                }\n\n                if (fontSizeSelect) {\n                    const sizeValue = (computed.fontSize || '').trim();\n                    const knownValues = Array.from(fontSizeSelect.options)\n                        .map((option) => option.value)\n                        .filter((value) => value && value !== '__custom__');\n\n                    if (sizeValue && knownValues.includes(sizeValue)) {\n                        fontSizeSelect.value = sizeValue;\n                        ensureCustomOption(fontSizeSelect, '');\n                    } else if (sizeValue) {\n                        ensureCustomOption(fontSizeSelect, sizeValue);\n                    } else {\n                        fontSizeSelect.value = '';\n                        ensureCustomOption(fontSizeSelect, '');\n                    }\n                }\n            };\n\n            const applyFontFamily = (key) => {\n                if (!surface) {\n                    return;\n                }\n\n                const stack = key ? fontStacks[key] ?? key : 'inherit';\n                wrapSelectionWithStyles({ fontFamily: stack });\n                updateStorage();\n                syncTypographyControls();\n            };\n\n            const applyFontSize = (value) => {\n                if (!surface) {\n                    return;\n                }\n\n                const resolved = value ? value : 'inherit';\n                wrapSelectionWithStyles({ fontSize: resolved });\n                updateStorage();\n                syncTypographyControls();\n            };\n\n            if (!storage) {\n                return;\n            }\n\n            const normalizeText = () => {\n                if (!surface) {\n                    return '';\n                }\n\n                return surface.innerText\n                    .replace(/\\u00a0/g, ' ')\n                    .replace(/\\r/g, '')\n                    .replace(/\\n{3,}/g, '\\n\\n')\n                    .trim();\n            };\n\n            const formatNumber = (value) => {\n                try {\n                    return new Intl.NumberFormat().format(value);\n                } catch {\n                    return `${value}`;\n                }\n            };\n\n            const updateMetrics = (snapshot) => {\n                if (!metricsRoot) {\n                    return;\n                }\n\n                const plain = snapshot?.plain || '';\n                const words = plain\n                    ? plain.trim().split(/\\s+/).filter(Boolean).length\n                    : 0;\n                const chars = plain.replace(/\\s/g, '').length;\n                const readingMinutes = words / 200;\n                let readingLabel = '0 min read';\n\n                if (words > 0) {\n                    if (readingMinutes < 1) {\n                        readingLabel = '<1 min read';\n                    } else {\n                        readingLabel = `${Math.max(1, Math.round(readingMinutes))} min read`;\n                    }\n                }\n\n                if (wordsMetric) {\n                    wordsMetric.textContent = `${formatNumber(words)} ${words === 1 ? 'word' : 'words'}`;\n                }\n\n                if (charsMetric) {\n                    charsMetric.textContent = `${formatNumber(chars)} ${chars === 1 ? 'character' : 'characters'}`;\n                }\n\n                if (readMetric) {\n                    readMetric.textContent = readingLabel;\n                }\n            };\n\n            const buildSnapshot = () => {\n                if (mode === 'text') {\n                    const plain = normalizeText();\n                    return {\n                        plain,\n                        html: escapeHtml(plain).replace(/(?:\\r\\n|\\r|\\n)/g, '<br>')\n                    };\n                }\n\n                if (editor.dataset.code === 'true' && codeArea) {\n                    const sanitized = sanitizeHtml(codeArea.value.trim());\n                    return {\n                        plain: sanitized.replace(/<[^>]+>/g, ' ').replace(/\\s+/g, ' ').trim(),\n                        html: sanitized\n                    };\n                }\n\n                if (surface) {\n                    const rawHtml = surface.innerHTML\n                        .replace(/<div><br><\\/div>/gi, '<br>')\n                        .replace(/<p><br><\\/p>/gi, '<br>');\n\n                    const sanitized = sanitizeHtml(rawHtml).trim();\n\n                    return {\n                        plain: surface.innerText\n                            .replace(/\\u00a0/g, ' ')\n                            .replace(/\\r/g, '')\n                            .replace(/\\s+\\n/g, '\\n')\n                            .trim(),\n                        html: sanitized\n                    };\n                }\n\n                return { plain: '', html: '' };\n            };\n\n            const updateStorage = () => {\n                const snapshot = buildSnapshot();\n                if (mode === 'text') {\n                    storage.value = snapshot.plain;\n                } else {\n                    storage.value = snapshot.html;\n                }\n\n                editor.dispatchEvent(new CustomEvent('rich-editor-change', {\n                    bubbles: true,\n                    detail: {\n                        editor,\n                        mode,\n                        plainText: snapshot.plain,\n                        html: snapshot.html\n                    }\n                }));\n\n                updateMetrics(snapshot);\n                if (surface) {\n                    syncTypographyControls();\n                }\n            };\n\n            if (surface) {\n                surface.addEventListener('input', updateStorage);\n                surface.addEventListener('blur', () => {\n                    if (surface.innerText.trim() === '') {\n                        surface.innerHTML = '';\n                    }\n\n                    updateStorage();\n                    syncTypographyControls();\n                });\n                surface.addEventListener('keyup', syncTypographyControls);\n                surface.addEventListener('mouseup', syncTypographyControls);\n\n                if (!editor.__selectionListener) {\n                    const monitorSelection = () => {\n                        const selection = window.getSelection();\n                        if (!selection || selection.rangeCount === 0) {\n                            return;\n                        }\n\n                        const anchor = selection.focusNode || selection.anchorNode;\n                        if (anchor && surface.contains(anchor)) {\n                            syncTypographyControls();\n                        }\n                    };\n\n                    editor.__selectionListener = monitorSelection;\n                    document.addEventListener('selectionchange', monitorSelection);\n                }\n            }\n\n            if (fontFamilySelect) {\n                fontFamilySelect.addEventListener('change', (event) => {\n                    applyFontFamily(event.target.value);\n                });\n            }\n\n            if (fontSizeSelect) {\n                fontSizeSelect.addEventListener('change', (event) => {\n                    const selected = event.target.value;\n                    if (selected === '__custom__') {\n                        const customValue = window.prompt('Enter a CSS font-size (e.g. 18px, 1.25rem, clamp(1rem, 2vw, 2rem))');\n                        if (!customValue || !customValue.trim()) {\n                            fontSizeSelect.value = '';\n                            ensureCustomOption(fontSizeSelect, '');\n                            return;\n                        }\n\n                        const trimmed = customValue.trim();\n                        ensureCustomOption(fontSizeSelect, trimmed);\n                        applyFontSize(trimmed);\n                        return;\n                    }\n\n                    ensureCustomOption(fontSizeSelect, '');\n                    applyFontSize(selected);\n                });\n            }\n\n            if (codeArea) {\n                codeArea.addEventListener('input', updateStorage);\n            }\n\n            const execCommand = (command, value) => {\n                if (command === 'toggle-code' && codeArea) {\n                    const isActive = editor.dataset.code === 'true';\n                    if (!isActive) {\n                        codeArea.value = surface ? surface.innerHTML.trim() : storage.value;\n                        editor.dataset.code = 'true';\n                        codeArea.focus({ preventScroll: true });\n                    } else {\n                        editor.dataset.code = 'false';\n                        if (surface) {\n                            surface.innerHTML = sanitizeHtml(codeArea.value);\n                            surface.focus({ preventScroll: true });\n                        }\n                    }\n\n                    updateStorage();\n                    return;\n                }\n\n                if (!surface) {\n                    return;\n                }\n\n                if (command === 'createLink') {\n                    let url = window.prompt('Enter URL');\n                    if (!url) {\n                        document.execCommand('unlink');\n                        updateStorage();\n                        return;\n                    }\n\n                    url = url.trim();\n                    if (url && !/^https?:\\/\\//i.test(url)) {\n                        url = `https://${url}`;\n                    }\n\n                    surface.focus({ preventScroll: true });\n                    document.execCommand('createLink', false, url);\n                    updateStorage();\n                    return;\n                }\n\n                let resolvedCommand = command;\n\n                if (resolvedCommand === 'HiliteColor' && !document.queryCommandSupported('HiliteColor')) {\n                    resolvedCommand = 'backColor';\n                }\n\n                surface.focus({ preventScroll: true });\n\n                if (resolvedCommand === 'removeFormat') {\n                    document.execCommand('removeFormat');\n                    document.execCommand('unlink');\n                    updateStorage();\n                    return;\n                }\n\n                if (resolvedCommand === 'formatBlock') {\n                    document.execCommand('formatBlock', false, value || 'p');\n                } else {\n                    document.execCommand(resolvedCommand, false, value);\n                }\n\n                updateStorage();\n            };\n\n            editor.querySelectorAll('[data-command]').forEach((button) => {\n                button.addEventListener('click', () => {\n                    execCommand(button.dataset.command, button.dataset.value);\n                });\n            });\n\n            const previewTarget = editor.dataset.previewTarget;\n            if (previewTarget) {\n                const summaryElement = document.querySelector(`[data-preview-tab=\"${previewTarget}\"] [data-preview-summary]`);\n                editor.addEventListener('rich-editor-change', (event) => {\n                    const target = document.querySelector(`[data-preview-section=\"${previewTarget}\"]`);\n                    if (!target) {\n                        return;\n                    }\n\n                    const detail = event.detail || {};\n                    const container = target.closest('.preview-canvas__section');\n\n                    target.innerHTML = detail.html || '';\n\n                    const isEmpty = !detail.plainText && !detail.html;\n                    if (isEmpty) {\n                        target.classList.add('preview-canvas__content--empty');\n                        if (container) {\n                            container.classList.add('preview-canvas__section--empty');\n                        }\n                    } else {\n                        target.classList.remove('preview-canvas__content--empty');\n                        if (container) {\n                            container.classList.remove('preview-canvas__section--empty');\n                        }\n                    }\n\n                    target.classList.add('preview-canvas__content--dirty');\n                    if (container) {\n                        container.classList.add('preview-canvas__section--dirty');\n                    }\n\n                    if (target.__dirtyTimeout) {\n                        window.clearTimeout(target.__dirtyTimeout);\n                    }\n\n                    if (container && container.__dirtyTimeout) {\n                        window.clearTimeout(container.__dirtyTimeout);\n                    }\n\n                    target.__dirtyTimeout = window.setTimeout(() => {\n                        target.classList.remove('preview-canvas__content--dirty');\n                    }, 700);\n\n                    if (container) {\n                        container.__dirtyTimeout = window.setTimeout(() => {\n                            container.classList.remove('preview-canvas__section--dirty');\n                        }, 700);\n                    }\n\n                    if (summaryElement) {\n                        const snippetSource = detail.plainText && detail.plainText.trim()\n                            ? detail.plainText\n                            : detail.html\n                                ? detail.html.replace(/<[^>]+>/g, ' ')\n                                : '';\n                        summaryElement.textContent = buildSummarySnippet(snippetSource);\n                    }\n                });\n            }\n\n            const form = editor.closest('form');\n            editorInstances.push({ editor, form, updateStorage });\n\n            if (form && !processedForms.has(form)) {\n                processedForms.add(form);\n                form.addEventListener('submit', () => {\n                    editorInstances\n                        .filter((instance) => instance.form === form)\n                        .forEach((instance) => instance.updateStorage());\n                });\n            }\n\n            updateStorage();\n            syncTypographyControls();\n        };\n\n        editors.forEach(setupEditor);\n    };\n\n    const initSectionFilters = () => {\n        const sectionsRoot = document.querySelector('[data-editor-sections]');\n        if (!sectionsRoot) {\n            return;\n        }\n\n        const cards = Array.from(sectionsRoot.querySelectorAll('[data-editor-card]'));\n        if (!cards.length) {\n            return;\n        }\n\n        const searchInput = document.querySelector('[data-editor-search]');\n        const filterCount = document.querySelector('[data-editor-filter-count]');\n        const toggles = Array.from(document.querySelectorAll('[data-editor-filter]'));\n        const activeFilters = new Set();\n\n        const applyFilters = () => {\n            const query = (searchInput?.value || '').trim().toLowerCase();\n            const visibleCards = [];\n\n            cards.forEach((card) => {\n                let isVisible = true;\n                const status = card.dataset.sectionStatus || '';\n                const hasDraft = card.dataset.hasDraft === 'true';\n                const keywords = `${card.dataset.sectionTitle ?? ''} ${card.dataset.sectionKey ?? ''}`.toLowerCase();\n\n                if (query && !keywords.includes(query)) {\n                    isVisible = false;\n                }\n\n                if (isVisible && activeFilters.has('editable') && status !== 'editable') {\n                    isVisible = false;\n                }\n\n                if (isVisible && activeFilters.has('draft') && !hasDraft) {\n                    isVisible = false;\n                }\n\n                card.hidden = !isVisible;\n                if (isVisible) {\n                    visibleCards.push(card);\n                }\n            });\n\n            if (filterCount) {\n                const total = cards.length;\n                filterCount.textContent = visibleCards.length === total\n                    ? `${total} sections`\n                    : `${visibleCards.length} of ${total} sections`;\n            }\n        };\n\n        if (searchInput) {\n            searchInput.addEventListener('input', () => {\n                window.requestAnimationFrame(applyFilters);\n            });\n        }\n\n        toggles.forEach((toggle) => {\n            toggle.addEventListener('click', () => {\n                const key = toggle.dataset.editorFilter;\n                if (!key) {\n                    return;\n                }\n\n                if (activeFilters.has(key)) {\n                    activeFilters.delete(key);\n                    toggle.dataset.state = 'off';\n                } else {\n                    activeFilters.add(key);\n                    toggle.dataset.state = 'on';\n                }\n\n                applyFilters();\n            });\n        });\n\n        applyFilters();\n    };\n\n    const init = () => {\n        initProfileMenus();\n        initNavDropdowns();\n        initRichEditors();\n        initSectionFilters();\n        initLibraryConsole();\n        initSchemaSidebar();\n        initTimelinePanel();\n        initSectionDetails();\n        initPublishConsole();\n        initDashboardNotifications();\n        initInsightsAnalytics();\n    };\n\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', init);\n    } else {\n        init();\n    }\n})();\n\nexport {};\n"],"names":["SVG_NS","DATE_FORMAT","computeTrend","points","width","height","normalized","point","maxValue","entry","actualWidth","step","computed","index","makeSvg","svg","createPath","d","className","path","createCircle","x","y","value","label","circle","renderTrendChart","host","trend","margin","chartWidth","chartHeight","empty","group","baseline","pathPoints","lineD","areaD","midValue","grid","axis","labels","labelIndices","text","renderBreakdownList","entries","emptyLabel","total","sum","list","item","bar","percentage","DATE_TIME_FORMAT","formatHighlight","date","renderStoryline","events","event","icon","content","heading","title","timestamp","summary","accent","badge","RANGE_FORMAT","parsePayload","script","raw","_a","error","formatRange","start","end","startDate","endDate","hydrateAnalytics","root","payload","trendHost","editorsHost","fieldsHost","storylineHost","summaryLabel","range","discoverRoots","target","element","initInsightsAnalytics","roots","fallback","createStore","initializer","listeners","getInitialState","state","getState","setState","action","partial","listener","subscribe","reset","resourceCache","DEFAULT_TTL_MS","fetchResource","cacheKey","input","options","now","ttlMs","cached","headers","response","extractErrorMessage","data","etag","CONTENT_BASE","fetchPageCollection","fetchSections","pageId","search","fetchHistory","params","key","url","sidebarCards","workflowSchemas","getSidebarCard","registry","cardId","getWorkflow","workflowId","memoryChannels","getMemoryChannel","name","channel","generateId","cryptoRef","nowIso","isBroadcastChannelAvailable","isWindowAvailable","createEventBus","busId","broadcastChannel","windowListener","memoryUnsubscribe","log","level","message","context","dispatchLocal","envelope","handleRemote","topic","capabilityFlags","normaliseId","id","hasCapability","normalised","metrics","isCapabilitySatisfied","registration","capability","defaultFormatter","result","resolveMetric","resolved","_b","resolveMetrics","ids","acc","METRIC_IDS","CARD_SEQUENCE","initSchemaSidebar","cardsHost","workflowHost","sourceData","collectMetricSource","resolveSidebarMetricValues","schema","card","renderCard","workflow","renderWorkflow","article","cardInner","metricGrid","metric","metricValue","displayValue","formatMetric","renderMetric","actionBar","button","hint","safeNumber","parsed","source","buildFallbackMetricMap","description","emphasis","wrapper","iconEl","labelEl","valueEl","desc","formatter","trimmed","numeric","clamped","inner","SYNC_CHANNEL_NAME","DEFAULT_SYNC_INTERVAL_MS","TIMELINE_EVENT_LIMIT","initialState","store","syncBus","syncTimer","handleSyncEvent","createTimelineState","trimEvents","withTimelineState","updater","current","currentTimeline","nextTimeline","getTimelineStateSnapshot","pushTimelineEvent","filtered","setDirtySectionState","sectionId","nextState","next","addConflictSection","clearConflictSection","setReviewStatus","status","recordPublishSummary","recordSyncTelemetry","telemetry","syncedAtUtc","appendHistoryEntriesToTimeline","knownIds","newEvents","a","b","buildHistoryEvent","cleanSectionKey","diff","resolveSectionLabel","candidate","timeline","dirty","summaryEntry","describeDiff","change","contentType","annotation","_d","_c","parts","describeReviewStatus","actor","scope","deltaFragment","snippet","snippetFragment","sectionLabel","previousDirty","syncedAt","isBrowser","getDashboardState","useDashboardStore","loadDashboardPages","force","pages","totals","selectDashboardPage","currentState","loadDashboardHistory","take","historyItems","getDashboardHistory","getTimelineSnapshot","resolvedPageId","timelineState","fetchHistoryForSync","startDashboardSync","intervalMs","interval","runSync","startedAt","durationMs","stopDashboardSync","SOURCE_LABEL","REVIEW_LABEL","initTimelinePanel","eventsHost","emptyState","lastSyncEl","summaryList","summaryEmpty","sectionCards","collectSectionCards","render","snapshot","renderTimeline","renderPublishSummary","updateLastSync","updateSectionIndicators","unsubscribe","teardown","map","createTimelineEventNode","meta","formatEventTime","formatChangeType","cards","refs","dirtyState","describeDiffShort","FRESH_THRESHOLD_HOURS","STALE_THRESHOLD_DAYS","DATE_FULL","DATE_TIME_SHORT","TIME_ONLY","initLibraryConsole","metricsRefs","badgeCount","pageGrid","trendingHost","controlsHost","searchInput","statusRefs","inspectorRoot","inspector","createInspector","createSectionsLoader","createActivityLoader","extractPagesFromDom","page","normalizePageItem","applyRender","renderLibrary","chip","term","inspectButton","updateActiveControl","sortButton","sortKey","filterButton","filterKey","totalCount","filterPage","matchesSearch","sortPages","renderPageCards","updateHeroMetrics","updateStatusMetrics","renderTrending","filter","updatedAt","hasValidUpdatedAt","lastPublished","hasValidPublishedAt","hoursSince","sort","container","fragment","createPageCard","header","slug","createMetricEntry","footer","updatedLabel","updatedTime","formatFullDate","updatedSecondary","formatTimeOnly","publishedLabel","actions","createActionLink","createDetailButton","dt","dd","href","iconClass","external","anchor","counts","meter","kind","nextValue","ratio","top","formatDateTimeShort","selector","items","node","ensureString","pick","ensureSlug","updatedSource","publishedSource","updatedIso","ensureIsoString","publishedIso","ensureId","ensureNumber","parsedFallback","keys","slugCandidate","idCandidate","cache","sections","mapSectionForInspector","history","section","services","slugEl","titleEl","descriptionEl","sectionsEl","textEl","imagesEl","signalsList","sectionList","activityList","tabs","panels","closers","lastTrigger","activeTab","tab","updateInspectorTabs","closer","hide","open","trigger","renderSummary","renderSections","renderActivity","closeButton","buildSummarySignals","signal","loader","buildHistorySnippet","active","isActive","panel","signals","updated","textRatio","previous","truncate","length","DATE_WITH_TIME","initSectionDetails","pageRoot","contexts","setupCardContext","refresh","updateContextFromTimeline","updateTabVisualState","populateDetails","populateHistory","metaHost","flagsHost","actionsHost","dataset","timelineDirty","reviewStatus","isConflicted","rows","formatDate","flags","formatReviewStatus","flag","capitalize","body","buildDiffSummary","historyList","historyEmpty","details","buildHistorySummary","sectionKey","summaryParts","DEFAULT_TASKS","initPublishConsole","summaryPanel","consoleRoot","notificationsHost","publishForm","openButton","previewList","previewEmpty","summaryCount","taskList","taskEmpty","taskProgress","taskForm","notesInput","statusHost","confirmButton","closeButtons","task","updateSummary","updateTaskViews","updateStatus","openConsole","closeConsole","pushNotification","taskId","detail","notes","elements","tasks","completed","limited","checkbox","remove","hasOutstandingTasks","hasSummary","initDashboardNotifications","seen","handleSnapshot","dispatchTask","initProfileMenus","menus","toggleSelector","activeMenu","findMenu","menu","setMenuState","isOpen","closeMenu","openMenu","focusFirstAction","firstAction","isToggle","toggle","initNavDropdowns","dropdowns","closeAll","exception","dropdown","shouldRemainOpen","initRichEditors","editors","ALLOWED_STYLE_PROPERTIES","sanitizeStyleAttribute","segment","rawProperty","rawValueParts","property","rawValue","sanitizeHtml","template","attr","cleaned","escapeHtml","editorInstances","processedForms","setupEditor","editor","mode","surface","storage","codeArea","metricsRoot","wordsMetric","charsMetric","readMetric","fontFamilySelect","fontSizeSelect","styleButtons","fontStacks","buildSummarySnippet","ensureCustomOption","select","existing","selectionWithinSurface","selection","contextElement","wrapSelectionWithStyles","styles","span","newRange","markActiveStyleButton","controls","isDefaultStyleButton","hasLine","hasLetter","hasWord","hasTransform","applyStyleButton","updateStorage","syncTypographyControls","defaultState","resolveFontKey","fontFamily","primary","sizeValue","knownValues","option","applyFontFamily","stack","applyFontSize","normalizeText","formatNumber","updateMetrics","plain","words","chars","readingMinutes","readingLabel","buildSnapshot","sanitized","rawHtml","monitorSelection","selected","customValue","execCommand","command","resolvedCommand","previewTarget","summaryElement","snippetSource","form","instance","initSectionFilters","sectionsRoot","filterCount","toggles","activeFilters","applyFilters","query","visibleCards","isVisible","hasDraft","keywords","init"],"mappings":"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"}