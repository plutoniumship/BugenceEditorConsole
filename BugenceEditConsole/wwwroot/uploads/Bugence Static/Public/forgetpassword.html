<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BUGENCE — Forgot Password</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            bug: {
              50: '#f5f7ff', 100: '#e9edff', 200: '#cdd7ff', 300: '#a7b5ff',
              400: '#7b89ff', 500: '#5663ff', 600: '#3f49e6', 700: '#3239b3', 800: '#2a2f8c', 900: '#23276f'
            }
          },
          boxShadow: {
            glow: '0 10px 30px -10px rgba(86,99,255,0.55), 0 2px 10px rgba(0,0,0,.35)'
          }
        }
      }
    }
  </script>

  <!-- Bootstrap (optional) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" crossorigin="anonymous" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    html, body { height: 100%; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial; }

    .cursor-dot { position: fixed; width: 14px; height: 14px; border-radius: 9999px; pointer-events: none; z-index: 50; mix-blend-mode: difference; background: white; transition: transform .18s ease, background .18s ease; transform: translate(-50%, -50%); }
    .cursor-ring { position: fixed; width: 42px; height: 42px; border: 2px solid rgba(255,255,255,.55); border-radius: 9999px; pointer-events:none; z-index: 49; transform: translate(-50%,-50%); transition: transform .25s ease, opacity .25s ease; opacity: .6; }

    .float-shape { animation: floaty 8s ease-in-out infinite; }
    @keyframes floaty { 0%, 100% { transform: translateY(0) } 50% { transform: translateY(-10px) } }

    .glow:focus { box-shadow: 0 0 0 4px rgba(86,99,255,.25); }
  </style>
</head>
<body class="min-h-screen bg-black text-white relative overflow-hidden">
  <!-- Background -->
  <div class="pointer-events-none absolute inset-0">
    <div class="absolute inset-0 opacity-80" style="background: radial-gradient(1200px 600px at 80% 10%, rgba(86,99,255,.20), transparent 60%), radial-gradient(900px 500px at 10% 80%, rgba(255,171,0,.14), transparent 55%), radial-gradient(900px 900px at 50% -10%, rgba(255,255,255,.04), transparent 60%);"></div>
    <div class="absolute inset-0 bg-[linear-gradient(transparent,transparent),linear-gradient(90deg,rgba(255,255,255,.06)_1px,transparent_1px),linear-gradient(rgba(255,255,255,.06)_1px,transparent_1px)] bg-[length:100%_100%,40px_40px,40px_40px]"></div>
  </div>

  <!-- Cursor -->
  <div class="cursor-ring" id="cursorRing"></div>
  <div class="cursor-dot" id="cursorDot"></div>

  <!-- Header -->
  <header class="relative z-10">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6 flex items-center justify-between">
      <a href="/" class="group inline-flex items-center gap-3">
        <span class="inline-flex h-10 w-10 items-center justify-center rounded-2xl bg-white text-black shadow-glow group-hover:scale-105 transition">
          <img src="/img/blackbug.svg" alt="BUGENCE" class="h-6 w-6"/>
        </span>
        <span class="text-xl sm:text-2xl font-extrabold tracking-tight">BUGENCE</span>
      </a>
      <a href="/login.html" class="inline-flex items-center gap-2 rounded-full border border-white/15 bg-white/5 px-4 py-2 text-sm font-semibold backdrop-blur hover:bg-white/10 active:scale-[.98] transition">
        <i class="fa-solid fa-right-to-bracket"></i>
        Back to Login
      </a>
    </div>
  </header>

  <!-- Main -->
  <main class="relative z-10">
    <section class="mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 py-10">
      <div class="relative overflow-hidden rounded-3xl bg-white text-black p-8 sm:p-10 shadow-glow">
        <div class="absolute -top-10 -right-10 h-40 w-40 rounded-full bg-bug-500/20 blur-2xl float-shape"></div>
        <div class="absolute -bottom-12 -left-12 h-48 w-48 rounded-full bg-amber-400/20 blur-2xl float-shape" style="animation-delay: -2s"></div>

        <!-- Progress -->
        <ol id="progress" class="flex items-center justify-center gap-6 text-xs font-semibold text-black/60">
          <li data-step="1" class="flex items-center gap-2"><span class="badge flex h-7 w-7 items-center justify-center rounded-full bg-black text-white">1</span>Email</li>
          <li data-step="2" class="flex items-center gap-2 opacity-60"><span class="badge flex h-7 w-7 items-center justify-center rounded-full bg-black/10 text-black">2</span>Verify</li>
          <li data-step="3" class="flex items-center gap-2 opacity-60"><span class="badge flex h-7 w-7 items-center justify-center rounded-full bg-black/10 text-black">3</span>Reset</li>
        </ol>

        <h1 class="mt-6 text-center text-2xl sm:text-3xl font-extrabold tracking-tight">Forgot your password?</h1>
        <p class="mt-2 text-center text-black/70 max-w-xl mx-auto">Follow the 3 quick steps below to reset your password.</p>

        <div id="steps" class="mt-8">
          <!-- GLOBAL inline banners -->
          <div id="banner" class="hidden mb-4 rounded-2xl border px-4 py-3 text-sm"></div>

          <!-- Step 1: Email -->
          <form id="stepEmail" class="space-y-6">
            <div>
              <label for="email" class="mb-2 block text-sm font-semibold text-black/80">Email address</label>
              <div class="relative">
                <i class="fa-solid fa-envelope absolute left-3 top-1/2 -translate-y-1/2 text-black/40"></i>
                <input type="email" id="email" required placeholder="you@company.com" class="glow w-full rounded-2xl border border-black/15 bg-white px-10 py-3 text-sm outline-none transition placeholder:text-black/40 focus:border-bug-500" />
              </div>
              <p id="errEmail" class="mt-2 hidden rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-xs text-red-700">Please enter a valid email.</p>
            </div>

            <div class="grid sm:grid-cols-2 gap-4">
              <div class="rounded-2xl border border-black/10 p-4 text-sm text-black/70">
                <div class="flex items-center gap-2 font-semibold text-black/80"><i class="fa-solid fa-shield-halved"></i> Security tip</div>
                <p class="mt-2">We’ll email a one-time code. It expires in <span class="font-semibold">15 minutes</span>.</p>
              </div>
              <div class="rounded-2xl border border-black/10 p-4 text-sm text-black/70">
                <div class="flex items-center gap-2 font-semibold text-black/80"><i class="fa-solid fa-clock"></i> Having trouble?</div>
                <p class="mt-2">Check spam, or <a href="#" class="text-bug-700 hover:text-bug-600">contact support</a>.</p>
              </div>
            </div>

            <!-- IMPORTANT: No animation/effect on this button -->
            <button id="sendEmailBtn" type="submit" class="w-full rounded-2xl bg-black px-6 py-3 text-white font-semibold tracking-wide shadow-lg shadow-black/20">
              <span class="inline-flex items-center justify-center gap-2">
                <i class="fa-solid fa-paper-plane"></i>
                Send Reset Link
              </span>
            </button>

            <div class="text-center text-sm text-black/70">
              Remembered your password? <a href="/login.html" class="font-semibold text-bug-700 hover:text-bug-600">Back to login</a>
            </div>
          </form>

          <!-- Step 2: Verify Code -->
          <form id="stepVerify" class="space-y-6 hidden">
            <p class="text-black/70">We sent a 6‑digit code to <span id="verifyEmail" class="font-semibold">your email</span>. Enter it below.</p>
            <div>
              <label class="mb-2 block text-sm font-semibold text-black/80">Verification code</label>
              <div class="grid grid-cols-6 gap-2" id="otpGrid">
                <input maxlength="1" inputmode="numeric" class="otp glow text-center rounded-xl border border-black/15 px-0 py-3" />
                <input maxlength="1" inputmode="numeric" class="otp glow text-center rounded-xl border border-black/15 px-0 py-3" />
                <input maxlength="1" inputmode="numeric" class="otp glow text-center rounded-xl border border-black/15 px-0 py-3" />
                <input maxlength="1" inputmode="numeric" class="otp glow text-center rounded-xl border border-black/15 px-0 py-3" />
                <input maxlength="1" inputmode="numeric" class="otp glow text-center rounded-xl border border-black/15 px-0 py-3" />
                <input maxlength="1" inputmode="numeric" class="otp glow text-center rounded-xl border border-black/15 px-0 py-3" />
              </div>
              <p id="errCode" class="mt-2 hidden rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-xs text-red-700">Enter the 6‑digit code.</p>
              <div class="mt-3 text-sm text-black/70">Didn’t get it? <button type="button" id="resend" class="font-semibold text-bug-700 hover:text-bug-600">Resend</button></div>
            </div>
            <div class="flex items-center justify-between">
              <button type="button" id="backToEmail" class="rounded-full border border-black/15 px-5 py-2 text-sm font-semibold hover:bg-black/5">Back</button>
              <button type="submit" id="verifyBtn" class="rounded-full bg-black px-6 py-2 text-white font-semibold">Verify</button>
            </div>
          </form>

          <!-- Step 3: Reset Password -->
          <form id="stepReset" class="space-y-6 hidden">
            <div>
              <label for="newpass" class="mb-2 block text-sm font-semibold text-black/80">New password</label>
              <input type="password" id="newpass" class="glow w-full rounded-2xl border border-black/15 bg-white px-4 py-3 text-sm outline-none transition placeholder:text-black/40 focus:border-bug-500" placeholder="••••••••" required />
            </div>
            <div>
              <label for="confpass" class="mb-2 block text-sm font-semibold text-black/80">Confirm password</label>
              <input type="password" id="confpass" class="glow w-full rounded-2xl border border-black/15 bg-white px-4 py-3 text-sm outline-none transition placeholder:text-black/40 focus:border-bug-500" placeholder="••••••••" required />
            </div>
            <ul class="text-xs text-black/60 space-y-1">
              <li>• At least 8 characters</li>
              <li>• Use upper + lower case, a number, and a symbol</li>
            </ul>
            <p id="errReset" class="hidden rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-xs text-red-700"></p>
            <div class="flex items-center justify-between">
              <button type="button" id="backToStep1" class="w-1/2 rounded-2xl border border-black/15 px-6 py-3 font-semibold">Back</button>
              <button type="submit" id="resetBtn" class="rounded-full bg-black px-6 py-2 text-white font-semibold">Reset Password</button>
            </div>
          </form>

          <!-- Success -->
          <div id="stepSuccess" class="hidden text-center space-y-4">
            <div class="inline-flex h-16 w-16 items-center justify-center rounded-full bg-bug-500 text-white shadow-glow">
              <i class="fa-solid fa-check text-2xl"></i>
            </div>
            <h3 class="text-xl font-extrabold">Password reset successful</h3>
            <p class="text-black/70">You can now sign in with your new password.</p>
            <a href="/login.html" class="inline-flex items-center justify-center rounded-full bg-black px-6 py-3 text-white font-semibold">Go to Login</a>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Scripts -->
  <script>
    // Cursor
    const dot = document.getElementById('cursorDot');
    const ring = document.getElementById('cursorRing');
    window.addEventListener('mousemove', (e) => {
      const { clientX:x, clientY:y } = e;
      dot.style.left = x + 'px';
      dot.style.top  = y + 'px';
      ring.style.left = x + 'px';
      ring.style.top  = y + 'px';
    });
    document.querySelectorAll('button, a, input').forEach(el => {
      el.addEventListener('mouseenter', ()=>{ dot.style.transform = 'translate(-50%, -50%) scale(1.6)'; });
      el.addEventListener('mouseleave', ()=>{ dot.style.transform = 'translate(-50%, -50%) scale(1)'; });
    });

    // Util banners (theme-matched, no window.alert)
    const banner = document.getElementById('banner');
    function showBanner(type, message) {
      // type: 'error' | 'success' | 'info'
      const styles = {
        error: 'border-red-200 bg-red-50 text-red-800',
        success: 'border-green-200 bg-green-50 text-green-800',
        info: 'border-blue-200 bg-blue-50 text-blue-800'
      };
      banner.className = `mb-4 rounded-2xl border px-4 py-3 text-sm ${styles[type]}`;
      banner.textContent = message;
      banner.classList.remove('hidden');
    }
    function hideBanner(){ banner.classList.add('hidden'); }

    // --- Multi-step logic ---
    const stepEmail = document.getElementById('stepEmail');
    const stepVerify = document.getElementById('stepVerify');
    const stepReset = document.getElementById('stepReset');
    const stepSuccess = document.getElementById('stepSuccess');
    const verifyEmail = document.getElementById('verifyEmail');
    const progress = document.getElementById('progress');

    const errEmail = document.getElementById('errEmail');
    const errCode = document.getElementById('errCode');
    const errReset = document.getElementById('errReset');

    const setError = (el, msg) => { if(!el) return; el.textContent = msg; el.classList.remove('hidden'); };
    const clearError = (el) => { el?.classList.add('hidden'); };

    const setStep = (n) => {
      hideBanner();
      [stepEmail, stepVerify, stepReset, stepSuccess].forEach((el,i)=>{
        if(!el) return; el.classList.toggle('hidden', (i+1)!==n && !(n===4 && i===3));
      });
      progress.querySelectorAll('li').forEach(li => {
        const s = Number(li.getAttribute('data-step'));
        const badge = li.querySelector('.badge');
        li.classList.remove('opacity-60');
        if (s < n) { badge.className = 'badge flex h-7 w-7 items-center justify-center rounded-full bg-bug-500 text-white'; li.style.opacity = '1'; }
        else if (s === n) { badge.className = 'badge flex h-7 w-7 items-center justify-center rounded-full bg-black text-white'; li.style.opacity = '1'; }
        else { badge.className = 'badge flex h-7 w-7 items-center justify-center rounded-full bg-black/10 text-black'; li.style.opacity = '0.6'; }
      });
    };

    // Step 1: send email
    stepEmail?.addEventListener('submit', async (e)=>{
      e.preventDefault(); hideBanner(); clearError(errEmail);
      const email = document.getElementById('email').value.trim();
      if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { setError(errEmail, 'Please enter a valid email.'); return; }
      // await fetch('/api/auth/forgot', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email }) });
      verifyEmail.textContent = email;
      setStep(2);
      showBanner('success', 'We sent a verification code to your email.');
    });
// Back button handler
document.getElementById('backToStep1').addEventListener('click', () => {
step2.classList.add('hidden');
step1.classList.remove('hidden');
});
    // Step 2: verify code
    const otpInputs = Array.from(document.querySelectorAll('#otpGrid .otp'));
    otpInputs.forEach((inp, idx)=>{
      inp.addEventListener('input', ()=>{ if(inp.value) otpInputs[idx+1]?.focus(); clearError(errCode); });
      inp.addEventListener('keydown', (ev)=>{ if(ev.key==='Backspace' && !inp.value) otpInputs[idx-1]?.focus(); });
    });
    document.getElementById('backToEmail')?.addEventListener('click', ()=> { setStep(1); hideBanner(); });
    stepVerify?.addEventListener('submit', async (e)=>{
      e.preventDefault(); hideBanner(); clearError(errCode);
      const code = otpInputs.map(i=>i.value).join('');
      if(!/^\d{6}$/.test(code)) { setError(errCode, 'Enter the 6‑digit code.'); return; }
      // await fetch('/api/auth/verify', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email: verifyEmail.textContent, code }) });
      setStep(3);
      showBanner('success', 'Code verified. Set your new password.');
    });

    // Resend
    document.getElementById('resend')?.addEventListener('click', async ()=>{
      hideBanner();
      // await fetch('/api/auth/forgot', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email: verifyEmail.textContent }) });
      showBanner('info', 'We sent a new code to your email.');
    });

    // Step 3: reset
    document.getElementById('backToVerify')?.addEventListener('click', ()=> { setStep(2); hideBanner(); });
    stepReset?.addEventListener('submit', async (e)=>{
      e.preventDefault(); hideBanner(); clearError(errReset);
      const p1 = document.getElementById('newpass').value;
      const p2 = document.getElementById('confpass').value;
      if(p1.length < 8) { setError(errReset, 'Password must be at least 8 characters.'); return; }
      if(p1 !== p2) { setError(errReset, 'Passwords do not match.'); return; }
      // await fetch('/api/auth/reset', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email: verifyEmail.textContent, new_password: p1 }) });
      setStep(4); // success
      showBanner('success', 'Your password has been reset.');
    });

    // Init
    setStep(1);
  </script>
</body>
</html>